---
layout: single
title: "ë¹ˆ ìŠ¤ì½”í”„"
categories: [basic]
tags: [basic]
toc: true
author_profile: true
---

# â˜• Spring ê³µë¶€ ê¸°ë¡

## ğŸ“˜ í•™ìŠµ ë‚ ì§œ
- 2025-07-09

## ğŸ“… ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©

### âœ¨ 1. ë¹ˆ ìŠ¤ì½”í”„ë€? 

ìŠ¤ì½”í”„ëŠ” ë¹ˆì´ ì¡´ì¬í•  ìˆ˜ ìˆëŠ” ë²”ìœ„ë¥¼ ëœ»í•œë‹¤.
ìŠ¤í”„ë§ì€ ë‹¤ì–‘í•œ ìŠ¤ì½”í”„ë¥¼ ì§€ì›í•œë‹¤.
1. ì‹±ê¸€í†¤ : ê¸°ë³¸ ìŠ¤ì½”í”„, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹œì‘ê³¼ ì£µë¡œê¹Œì§€ ìœ ì§€ë˜ëŠ” ê°€ì¥ ë„“ì€ ë²”ìœ„
2. í”„ë¡œí† íƒ€ì… : ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ í”„ë¡œí† íƒ€ì… ë¹ˆì˜ ìƒì„±ê³¼ ì˜ì¡´ê´€ê³„ ì£¼ì…ê¹Œì§€ë§Œ ê´€ì—¬í•˜ëŠ” ë§¤ìš° ì§§ì€ ë²”ìœ„
3. ì›¹ ê´€ë ¨ ìŠ¤ì½”í”„ : request -> ì›¹ ìš”ì²­ì´ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆë•Œ ê¹Œì§€ ìœ ì§€, session : ì›¹ ì„¸ì…˜ì´ ìƒì„±ë˜ê³  ì¢…ë£Œë  ë•Œ ê¹Œì§€ ìœ ì§€, application -> ì›¹ì˜ ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì™€ ê°™ì€ ë²”ìœ„ë¡œ ìœ ì§€

ë¹ˆ ìŠ¤ì½”í”„ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì§€ì •í•  ìˆ˜ ìˆë‹¤. @Scope("prototype")

### âœ¨ 2. í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„

- ì‹±ê¸€í†¤ ìŠ¤ì½”í”„ì˜ ë¹ˆì€ í•­ìƒ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì˜ ë¹ˆì„ ë°˜í™˜í•˜ëŠ” ë°˜ë©´, í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ì˜ ë¹ˆì€ ì¡°íšŒí•  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±í•´ì„œ ë°˜í™˜í•œë‹¤.
- í•µì‹¬ì€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•˜ê³ , ì˜ì¡´ê´€ê³„ ì£¼ì…, ì´ˆê¸°í™”ê¹Œì§€ë§Œ ì§„í–‰
- í´ë¼ì´ì–¸íŠ¸ ë¹ˆì„ ë°˜í™˜í•˜ê³ , ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ë”ì´ìƒ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ê´€ë¦¬ì§€ ì•ŠëŠ”ë‹¤. ì¦‰ @PreDestroy ê°™ì€ ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.
- ì¢…ë£Œ ë©”ì„œë“œì— ëŒ€í•œ í˜¸ì¶œì€ í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ í•´ì•¼í•œë‹¤.

####  2-1. ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ ë¬¸ì œì 

ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— í”„ë¡œí† íƒ€ì… ìŠ¤ì½”í”„ì˜ ë¹ˆì„ ìš”ì²­í•˜ë©´ í•­ìƒ ìƒˆë¡œìš´ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤. <br>
í•˜ì§€ë§Œ ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©í•  ë•ŒëŠ” ì˜ë„í•œ ëŒ€ë¡œ ì˜ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.

```java
 package hello.core.scope;
import org.junit.jupiter.api.Test;
 import org.springframework.beans.factory.annotation.Autowired;
 import 
org.springframework.context.annotation.AnnotationConfigApplicationContext;
 import org.springframework.context.annotation.Scope;
 import javax.annotation.PostConstruct;
 import javax.annotation.PreDestroy;
 import static org.assertj.core.api.Assertions.*;
 public class SingletonWithPrototypeTest1 {
    @Test
 void singletonClientUsePrototype() {
 AnnotationConfigApplicationContext ac = new 
AnnotationConfigApplicationContext(ClientBean.class, PrototypeBean.class);
 ClientBean clientBean1 = ac.getBean(ClientBean.class);
 int count1 = clientBean1.logic();
 assertThat(count1).isEqualTo(1);
 ClientBean clientBean2 = ac.getBean(ClientBean.class);
 int count2 = clientBean2.logic();
 assertThat(count2).isEqualTo(2);
    }
 static class ClientBean {
 private final PrototypeBean prototypeBean;

     @Autowired
     public ClientBean(PrototypeBean prototypeBean) {
         this.prototypeBean = prototypeBean;
     }
 public int logic() {
            prototypeBean.addCount();
 int count = prototypeBean.getCount();
 return count;
        }
    }
    @Scope("prototype")
 static class PrototypeBean {
 private int count = 0;
 public void addCount() {
            count++;
        }
 public int getCount() {
 return count;
        }
        @PostConstruct
 public void init() {
 System.out.println("PrototypeBean.init " + this);
        }
        @PreDestroy
 public void destroy() {
 System.out.println("PrototypeBean.destroy");
        }
    }
 }
```

- ì˜ˆì œë¥¼ ë³´ê²Œë˜ë©´, ì‹±ê¸€í†¤ ë¹ˆì€ ìƒì„± ì‹œì ì—ë§Œ ì˜ì¡´ê´€ê³„ ì£¼ì…ì„ ë°›ê¸° ë•Œë¬¸ì— ìƒì„±ë  ë•Œ í”„ë¡œí† íƒ€ì… ë¹ˆ ê°ì²´ í•˜ë‚˜ë¥¼ ì£¼ì… ë°›ê³ , ê³„ì† ìœ ì§€ê°€ ëœë‹¤.
- ê·¸ëŸ¬ë¯€ë¡œ clientBeanì„ 2ê°œë¥¼ ë§Œë“  ê²ƒ ì²˜ëŸ¼ ë³´ì—¬ë„, ì‹±ê¸€í†¤ì´ê¸° ë•Œë¬¸ì— clientBean1, clientBean2 ë‘˜ë‹¤ ê°™ì€ ê°ì²´ì´ê³ , ê°ê° addCount()ë¥¼ í˜¸ì¶œí•´ë„ countê°€ 1, 1ì´ ì•„ë‹Œ 2ê°€ ë˜ì–´ë²„ë¦°ë‹¤. 
- ê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ í•´ê²°í• ê¹Œ? 

#### 2-2. ì‹±ê¸€í†¤ ë¹ˆê³¼ í•¨ê»˜ ì‚¬ìš©ì‹œ Providerë¡œ ë¬¸ì œ í•´ê²°

ì´ ë‘ê°œì˜ ìŠ¤ì½”í”„ ë¹ˆì„ í•¨ê»˜ ì‚¬ìš©í•  ë–„ ì–´ë–»ê²Œ ì‚¬ìš©í•  ë•Œ ë§ˆë‹¤ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ìƒì„±í•  ìˆ˜ ìˆì„ê¹Œ?

ObjectFactory, ObjectProviderë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ObjectFactoryì— í¸ì˜ê¸°ëŠ¥ì„ ì¶”ê°€í•œê²Œ ObjectProviderì´ë‹¤.
```java
 @Autowired
 private ObjectProvider<PrototypeBean> prototypeBeanProvider;
 public int logic() {
 PrototypeBean prototypeBean = prototypeBeanProvider.getObject();
    prototypeBean.addCount();
 int count = prototypeBean.getCount();
 return count;
 }
```
- ì‹¤í–‰í•´ë³´ë©´ prototypeBeanProvider.getObject()ë¥¼ í†µí•´ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ìƒì„±ëœë‹¤.
- ObjectProviderì˜ getObject()ëŠ” ë‚´ë¶€ì—ì„œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ í•´ë‹¹ ë¹ˆì„ ì°¾ì•„ì„œ ë°˜í™˜í•œë‹¤. (DL)
- DL(Dependency Lookup): ì˜ì¡´ê´€ê³„ ì¡°íšŒ(íƒìƒ‰) , DI(Dependency injection) : ì˜ì¡´ê´€ê³„ ì£¼ì…
- ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì§€ë§Œ, ê¸°ëŠ¥ì´ ë‹¨ìˆœí•˜ë¯€ë¡œ ë‹¨ìœ„í…ŒìŠ¤íŠ¸, mock ì½”ë“œ ë§Œë“¤ê¸° í›¨ì”¬ ì‰¬ì›Œì§„ë‹¤.
- 

ë˜ ë‹¤ë¥¸ ë°©ë²•ì€ JSR-330 Providerë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ì´ê²ƒì€ ìë°” í‘œì¤€ ë°©ë²•ì´ë‹¤.
ì´ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ gradleì— ì¶”ê°€í•´ì•¼í•œë‹¤.

ìŠ¤í”„ë§ë¶€íŠ¸ 3.0 ë¯¸ë§Œ
javax.inject:javax.inject:1 <br>
ìŠ¤í”„ë§ë¶€íŠ¸ 3.0 ì´ìƒ
jakarta.inject:jakarta.inject-api:2.0.1

```java
 @Autowired
 private Provider<PrototypeBean> provider;
 public int logic() {
 PrototypeBean prototypeBean = provider.get();
    prototypeBean.addCount();
 int count = prototypeBean.getCount();
 return count;
 }
```
- ì‹¤í–‰í•´ë³´ë©´ provider.get()ì„ í†µí•´ í•­ìƒ ìƒˆë¡œìš´ í”„ë¡œí† íƒ€ì… ë¹ˆì´ ë°˜í™˜ëœë‹¤.
- ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•˜ë‹¤.
- ìë°” í‘œì¤€ì´ë¯€ë¡œ ìŠ¤í”„ë§ì´ ì•„ë‹Œ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ì •ë¦¬í•˜ìë©´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì–¸ì œ ì‚¬ìš©í•˜ë‚˜? <br>
ë§¤ë²ˆ ì‚¬ìš©í•  ë•Œ ë§ˆë‹¤ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ì™„ë£Œëœ ìƒˆë¡œìš´ ê°ì²´ê°€ í•„ìš”í•˜ë©´ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
ê·¸ëŸ¬ë‚˜ ì‹¤ë¬´ì—ì„œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•´ë³´ë©´, ì‹±ê¸€í†¤ ë¹ˆìœ¼ë¡œ ëŒ€ë¶€ë¶„ì˜ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì–´ í”„ë¡œí† íƒ€ì… ë¹ˆì„ ì§ì ‘ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì¼ì€ ë§¤ìš° ë“œë¬¼ë‹¤ê³ í•œë‹¤.

### âœ¨ 3. ì›¹ ìŠ¤ì½”í”„

- ì›¹ ìŠ¤ì½”í”„ëŠ” ì›¹ í™˜ê²½ì—ì„œë§Œ ë™ì‘í•œë‹¤.
- ìŠ¤í”„ë§ì´ í•´ë‹¹ ìŠ¤ì½”í”„ì˜ ì¢…ë£Œ ì‹œì ê¹Œì§€ ê´€ë¦¬í•œë‹¤. ì¦‰ ì¢…ë£Œ ë©”ì„œë“œê°€ í˜¸ì¶œëœë‹¤.
- request : HTTP ìš”ì²­ í•˜ë‚˜ê°€ ë“¤ì–´ì˜¤ê³  ë‚˜ê°ˆ ë•Œ ê¹Œì§€ ìœ ì§€ë˜ëŠ” ìŠ¤ì½”í”„, ê°ê°ì˜ HTTP ìš”ì²­ë§ˆë‹¤ ë³„ë„ì˜ ë¹ˆ ì¸ìŠ¤í„´
  ìŠ¤ê°€ ìƒì„±ë˜ê³ , ê´€ë¦¬ëœë‹¤. 
- session : HTTP Sessionê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„
- application : ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì™€ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„
- websocket : ì›¹ ì†Œì¼“ê³¼ ë™ì¼í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°€ì§€ëŠ” ìŠ¤ì½”í”„

#### 3-1. request ìŠ¤ì½”í”„ ì˜ˆì œ ê°œë°œ

ë™ì‹œì— ì—¬ëŸ¬ HTTP ìš”ì²­ì´ ì˜¤ë©´ ì •í™•íˆ ì–´ë–¤ ìš”ì²­ì´ ë‚¨ê¸´ ë¡œê·¸ì¸ì§€ êµ¬ë¶„í•˜ê¸° ì–´ë µë‹¤.
ì´ëŸ´ë•Œ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ ê²ƒì´ ë°”ë¡œ request ìŠ¤ì½”í”„ì´ë‹¤. request ìŠ¤ì½”í”„ ë¹ˆì€ HTTP ìš”ì²­ ë‹¹ í•˜ë‚˜ ì”© ìƒì„±ëœë‹¤.

[d06b992f...] request scope bean create
[d06b992f...][http://localhost:8080/log-demo] controller test
[d06b992f...][http://localhost:8080/log-demo] service id = testId
[d06b992f...] request scope bean close 
ì´ë ‡ê²Œ ë¡œê·¸ê°€ ë‚¨ë„ë¡ request ìŠ¤ì½”í”„ë¥¼ í™œìš©í•´ì„œ ì¶”ê°€ ê¸°ëŠ¥ì„ ê°œë°œí•´ë³´ì.

- UUID(message)ë¥¼ ì‚¬ìš©í•˜ì—¬ HTTP ìš”ì²­ì„ êµ¬ë¶„í•˜ì.
- requestURL ì •ë³´ë„ ì¶”ê°€ë¡œ ë„£ì–´ ì–´ë–¤ URLì„ ìš”ì²­í•´ì„œ ë‚¨ì€ ë¡œê·¸ì¸ì§€ í™•ì¸í•˜ì.

MyLogger

```java
 package hello.core.common;
 import org.springframework.context.annotation.Scope;
 import org.springframework.stereotype.Component;
 import javax.annotation.PostConstruct;
 import javax.annotation.PreDestroy;
 import java.util.UUID;
 @Component
 @Scope(value = "request")
 public class MyLogger {
 private String uuid;
 private String requestURL;
 public void setRequestURL(String requestURL) {
 this.requestURL = requestURL;
    }
 public void log(String message) {
 System.out.println("[" + uuid + "]" + "[" + requestURL + "] " + 
message);
    }
    @PostConstruct
 public void init() {
        uuid 
= UUID.randomUUID().toString();
 System.out.println("[" + uuid + "] request scope bean create:" + this);
    }
    @PreDestroy
 public void close() {
 System.out.println("[" + uuid + "] request scope bean close:" + this);
    }
 }
```

- ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤
- @Scope(value = "request")ë¥¼ ì‚¬ìš©í•˜ì—¬ request ìŠ¤ì½”í”„ë¡œ ì§€ì •
- ì´ ë¹ˆì´ ìƒì„±ë˜ëŠ” ì‹œì ì— ìë™ìœ¼ë¡œ @PostConstruct ì´ˆê¸°í™” ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ uuidë¥¼ ìƒì„±í•´ì„œ ì €ì¥í•´ë‘”ë‹¤. ì´ ë¹ˆì€ HTTP ìš”ì²­ ë‹¹ í•˜ë‚˜ì”© ìƒì„±ë˜ë¯€ë¡œ, UUIDë¥¼ í†µí•´ ë‹¤ë¥¸ HTTP ìš”ì²­ê³¼ êµ¬ë¶„ í•  ìˆ˜ ìˆë‹¤.
- ì´ ë¹ˆì´ ì†Œë©¸ë˜ëŠ” ì‹œì ì— @PreDestroyë¥¼ ì‚¬ìš©í•˜ì—¬ ì¢…ë£Œ ë©”ì‹œì§€ë¥¼ ë‚¨ê¸´ë‹¤.
- requestURLì€ ì´ ë¹ˆì´ ìƒì„±ë˜ëŠ” ì‹œì ì—ëŠ” ì•Œ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ì™¸ë¶€ì—ì„œ setterë¡œ ì…ë ¥ë°›ëŠ”ë‹¤.

LogDemoController
```java
 package hello.core.web;
 import hello.core.common.MyLogger;
 import hello.core.logdemo.LogDemoService;
 import lombok.RequiredArgsConstructor;
 import org.springframework.stereotype.Controller;
 import org.springframework.web.bind.annotation.RequestMapping;
 import org.springframework.web.bind.annotation.ResponseBody;
 import javax.servlet.http.HttpServletRequest;
 @Controller
 @RequiredArgsConstructor
 public class LogDemoController {
private final LogDemoService logDemoService;
 private final MyLogger myLogger;
    @RequestMapping("log-demo")
    @ResponseBody
 public String logDemo(HttpServletRequest request) {
 String requestURL = request.getRequestURL().toString();
        myLogger.setRequestURL(requestURL);
        myLogger.log("controller test");
        logDemoService.logic("testId");
 return "OK";
    }
 }
```
- ë¡œê±°ê°€ ì˜ ì‘ë™ë˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” í…ŒìŠ¤íŠ¸ìš© ì»¨íŠ¸ë¡¤ëŸ¬
- HttpServletRequestë¥¼ í†µí•´ ìš”ì²­ URLì„ ë°›ì•˜ë‹¤. (requestURL ê°’: http://localhost:8080/log-demo)
- ì´ë ‡ê²Œ ë°›ì€ requestURL ê°’ì„ myLoggerì— ì €ì¥í•´ë‘”ë‹¤. 
- ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ controller test ë¼ëŠ” ë¡œê·¸ë¥¼ ë‚¨ê¸´ë‹¤.

LogDemoService ì¶”ê°€

```java
package hello.core.logdemo;
 import hello.core.common.MyLogger;
 import lombok.RequiredArgsConstructor;
 import org.springframework.stereotype.Service;
 @Service
 @RequiredArgsConstructor
 public class LogDemoService {
private final MyLogger myLogger;
 public void logic(String id) {
        myLogger.log("service id = " + id);
    }
 }
```

- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ìˆëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œë„ ë¡œê·¸ë¥¼ ì¶œë ¥í•´ë³´ì.
- ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€, request scopeë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , íŒŒë¼ë¯¸í„°ë¡œ ì´ ëª¨ë“  ì •ë³´ë¥¼ ì„œë¹„ìŠ¤ ê³„ì¸µì— ë„˜ê¸´ë‹¤ë©´, íŒŒë¼ë¯¸í„°ê°€ ë§ì•„ì„œ ì§€ì €ë¶„í•´ì§„ë‹¤.
- ë” ë¬¸ì œëŠ” requestURL ê°™ì€ ì›¹ê³¼ ê´€ë ¨ëœ ì •ë³´ê°€ ì›¹ê³¼ ê´€ë ¨ì—†ëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µê¹Œì§€ ë„˜ì–´ê°€ê²Œ ëœë‹¤.
- ì›¹ê³¼ ê´€ë ¨ëœ ë¶€ë¶„ì€ ì»¨íŠ¸ë¡¤ëŸ¬ê¹Œì§€ë§Œ ì‚¬ìš©í•´ì•¼í•œë‹¤.
- ì„œë¹„ìŠ¤ ê³„ì¸µì€ ì›¹ ê¸°ìˆ ì— ì¢…ì†ë˜ì§€ ì•Šê³ , ê°€ê¸‰ì  ìˆœìˆ˜í•˜ê²Œ ìœ ì§€í•˜ëŠ” ê²ƒì´ ìœ ì§€ë³´ìˆ˜ ê´€ì ì—ì„œ ì¢‹ë‹¤.
- request scopeì˜ MyLogget ë•ë¶„ì— ì´ëŸ° ë¶€ë¶„ì„ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸°ì§€ ì•Šê³ , MyLoggerì˜ ë©¤ë²„ë³€ìˆ˜ì— ì €ì¥í•˜ì—¬ ì½”ë“œì™€ ê³„ì¸µì„ ê¹”ë”í•˜ê²Œ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.

ì´ì œ ì‹¤í–‰í•´ë³´ë©´ ê¸°ëŒ€ì™€ ë‹¤ë¥´ê²Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì ì— ì´ëŸ° ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.
Error creating bean with name 'myLogger': Scope 'request' is not active for the
current thread; consider defining a scoped proxy for this bean if you intend to
refer to it from a singleton;
ê·¸ ì´ìœ ëŠ” ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ëŠ” ì‹œì ì— ì‹±ê¸€í†¤ ë¹ˆì€ ìƒì„±í•´ì„œ ì£¼ì…ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, request ìŠ¤ì½”í”„ ë¹ˆì€
ì•„ì§ ìƒì„±ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤. ì´ ë¹ˆì€ ì‹¤ì œ ê³ ê°ì˜ ìš”ì²­ì´ ì™€ì•¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

#### 3-2. ìŠ¤ì½”í”„ì™€ Provider 

ì²«ë²ˆì§¸ í•´ê²°ë°©ì•ˆì€ ì•ì„œ ë°°ìš´ Providerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.

Controller, Service

```java
 package hello.core.web;
 import hello.core.common.MyLogger;
 import hello.core.logdemo.LogDemoService;
 import lombok.RequiredArgsConstructor;
 import org.springframework.beans.factory.ObjectProvider;
 import org.springframework.stereotype.Controller;
 import org.springframework.web.bind.annotation.RequestMapping;
 import org.springframework.web.bind.annotation.ResponseBody;
 import javax.servlet.http.HttpServletRequest;
 @Controller
 @RequiredArgsConstructor
 public class LogDemoController {
 private final LogDemoService logDemoService;
 private final ObjectProvider<MyLogger> myLoggerProvider;
    @RequestMapping("log-demo")
    @ResponseBody
 public String logDemo(HttpServletRequest request) {
 String requestURL = request.getRequestURL().toString();
 MyLogger myLogger = myLoggerProvider.getObject();
        myLogger.setRequestURL(requestURL);
        myLogger.log("controller test");
        logDemoService.logic("testId");
 return "OK";
    }
 }
 ```
 ```java
 package hello.core.logdemo;
 import hello.core.common.MyLogger;
 import lombok.RequiredArgsConstructor;
 import org.springframework.beans.factory.ObjectProvider;
 import org.springframework.stereotype.Service;
@Service
 @RequiredArgsConstructor
 public class LogDemoService {
 private final ObjectProvider<MyLogger> myLoggerProvider;
 public void logic(String id) {
 MyLogger myLogger = myLoggerProvider.getObject();
        myLogger.log("service id = " + id);
    }
 }
```

- main ë©”ì„œë“œë¡œ ìŠ¤í”„ë§ ì‹¤í–‰ í›„, log-demoë¡œ ë“¤ì–´ê°€ë©´ ì˜ ì‘ë™í•œë‹¤.
- ObjectProvider ë•ë¶„ì— getObject()ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹œì ê¹Œì§€ request ë¹ˆì˜ ìƒì„±ì„ ì§€ì—°í•  ìˆ˜ ìˆë‹¤.
- getObject()ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‹œì ì—ëŠ” HTTP ìš”ì²­ì´ ì§„í–‰ì¤‘ì´ë¯€ë¡œ request scope ë¹ˆì˜ ìƒì„±ì´ ì •ìƒ ì²˜ë¦¬ëœë‹¤.
- LogDemoController, LogDemoService ì—ì„œ ê°ê° í•œë²ˆì”© ë”°ë¡œ í˜¸ì¶œí•´ë„, ê°™ì€ HTTP ìš”ì²­ì´ë©´ ê°™ì€ ìŠ¤í”„ë§ ë¹ˆì´ ë°˜í™˜ëœë‹¤.
- ê°œë°œìì˜ ì½”ë“œ ëª‡ìë¥¼ ë” ì¤„ì´ë ¤ëŠ” ìš•ì‹¬ìœ¼ë¡œ ë˜ ë‹¤ë¥¸ ë°©ì‹ ì¡´ì¬

#### 3-3. ìŠ¤ì½”í”„ì™€ í”„ë¡ì‹œ
í”„ë¡ì‹œë°©ì‹ ì‚¬ìš©

```java
 @Component
 @Scope(value = "request", proxyMode = ScopedProxyMode.TARGET_CLASS)
 public class MyLogger {
 }
 ```
- ì ìš© ëŒ€ìƒì´ ì¸í„°í˜ì´ìŠ¤ê°€ ì•„ë‹Œ í´ë˜ìŠ¤ë©´ TARGET_CLASSë¥¼ ì„ íƒ, ì¸í„°í˜ì´ìŠ¤ë©´ INTERFACESë¥¼ ì„ íƒ
- ì´ë ‡ê²Œ í•˜ë©´ MyLoggerì˜ ê°€ì§œ í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ë‘ê³  HTTP requestì™€ ìƒê´€ ì—†ì´ ê°€ì§œ í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ë‹¤ë¥¸ ë¹ˆì— ë¯¸ë¦¬ ì£¼ì…í•´ ë‘˜ ìˆ˜ ìˆë‹¤.
- ì´ì œ ë‚˜ë¨¸ì§€ ì½”ë“œë¥¼ Provider ì‚¬ìš© ì´ì „ìœ¼ë¡œ ëŒë ¤ë‘ì–´ë„ ì˜ ë™ì‘í•œë‹¤.

#### 3-4. ì›¹ ìŠ¤ì½”í”„ì™€ í”„ë¡ì‹œ ë™ì‘ ì›ë¦¬

- myLogger.getClass()ë¡œ myLoggerë¥¼ í™•ì¸í•´ë³´ë©´ myLogger = class hello.core.common.MyLogger$$EnhancerBySpringCGLIB$$b68b726d ì´ëŸ°ì‹ìœ¼ë¡œ ì¶œë ¥ë˜ëŠ”ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- CGLIBë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë‚´ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ì£¼ì…í•œë‹¤.
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— myLoggerë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì§„ì§œ ëŒ€ì‹ ì•„ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë“±ë¡í•œë‹¤.
- ì˜ì¡´ê´€ê³„ ì£¼ì…ë„ ì´ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ê°€ ì£¼ì…ëœë‹¤.
- ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ìš”ì²­ì´ ì˜¤ë©´ ê·¸ë•Œ ë‚´ë¶€ì—ì„œ ì§„ì§œ ë¹ˆì„ ìš”ì²­í•˜ëŠ” ìœ„ì„ ë¡œì§ì´ ë“¤ì–´ìˆë‹¤.
- ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” ì§„ì§œ myLoggerë¥¼ ì°¾ëŠ” ë°©ë²•ì„ ì•Œê³ ìˆê³ , í´ë¼ì´ì–¸íŠ¸ê°€ myLogger.log()ë¥¼ í˜¸ì¶œí•˜ë©´ ì‚¬ì‹¤ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œ í•œ ê²ƒì´ë‹¤.
- ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ëŠ” request ìŠ¤ì½”í”„ì˜ ì§„ì§œ myLogger.log()ë¥¼ í˜¸ì¶œí•œë‹¤.
- í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„œëŠ” ì›ë³¸ì¸ì§€ ê°€ì§œì¸ì§€ë„ ëª¨ë¥´ê³  ë™ì¼í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥(ë‹¤í˜•ì„±)
- ë§ˆì¹˜ ì‹±ê¸€í†¤ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒ ê°™ì§€ë§Œ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ê²°êµ­ ì£¼ì˜í•´ì„œ ì‚¬ìš© í•„ìš”
- íŠ¹ë³„í•œ scopeëŠ” í•„ìš”í•œ ê³³ì—ë§Œ ìµœì†Œí™” í•´ì„œ ì‚¬ìš©í•˜ì. ë¬´ë¶„ë³„í•˜ê²Œ ì‚¬ìš©í•˜ë©´ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›Œì§.

ë‹¨ì§€ ì• ë…¸í…Œì´ì…˜ ì„¤ì • ë³€ê²½ë§Œìœ¼ë¡œ ì›ë³¸ ê°ì²´ë¥¼ í”„ë¡ì‹œ ê°ì²´ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤. ì´ê²ƒì´ ë°”ë¡œ ë‹¤í˜•ì„±ê³¼ DI ì»¨í…Œì´ë„ˆê°€ ê°€ì§„ í° ê°•ì ì´ë‹¤.


Providerë¥¼ ì‚¬ìš©í•˜ë“ , í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ë“ , í•µì‹¬ ì•„ì´ë””ì–´ëŠ” ì§„ì§œ ê°ì²´ ì¡°íšŒë¥¼ ê¼­ í•„ìš”í•œ ì‹œì ê¹Œì§€ ì§€ì—°ì²˜ë¦¬ í•œë‹¤ëŠ” ì ì´ë‹¤.