---
layout: single
title: "엔티티매핑"
categories: [jpa]
tags: [jpa]
toc: true
author_profile: true
---

# 엔티티 매핑 정리

---

## 목차
- 객체와 테이블 매핑
- 데이터베이스 스키마 자동 생성
- 필드와 컬럼 매핑
- 기본 키 매핑
- 실전 예제 1: 요구사항 분석과 기본 매핑

---

## 1. 엔티티 매핑 소개

- **객체와 테이블 매핑**: `@Entity`, `@Table`
- **필드와 컬럼 매핑**: `@Column`
- **기본 키 매핑**: `@Id`
- **연관관계 매핑**: `@ManyToOne`, `@JoinColumn`

### @Entity
- JPA가 관리하는 클래스 (엔티티).
- 기본 생성자 필수 (public 또는 protected).
- 사용 불가: `final class`, `enum`, `interface`, `inner class`.
- 저장할 필드에 `final` 불가.

### @Table
- 엔티티와 매핑할 테이블 지정.
- 주요 속성:
    - `name`: 매핑할 테이블 이름
    - `schema`, `catalog`
    - `uniqueConstraints`: 유니크 제약조건 생성 가능

---

## 2. 데이터베이스 스키마 자동 생성

- **DDL을 실행 시점에 자동 생성** → 개발 장비에서만 사용 권장.
- `hibernate.hbm2ddl.auto` 옵션:
    - `create`: 기존 테이블 삭제 후 새로 생성
    - `create-drop`: 종료 시점에 DROP
    - `update`: 변경분만 반영 (운영 DB에서 X)
    - `validate`: 매핑 검증만
    - `none`: 사용 안함

**주의**: 운영서버에서는 `validate` 또는 `none`만 사용.

---

## 3. 필드와 컬럼 매핑

### 예제 코드
```java
@Entity
public class Member {
    @Id
    private Long id;

    @Column(name = "name")
    private String username;

    private Integer age;

    @Enumerated(EnumType.STRING)
    private RoleType roleType;

    @Temporal(TemporalType.TIMESTAMP)
    private Date createdDate;

    @Temporal(TemporalType.TIMESTAMP)
    private Date lastModifiedDate;

    @Lob
    private String description;
}
```

### 주요 어노테이션
- `@Column`: 컬럼 속성 제어 (`name`, `nullable`, `unique`, `length`, `precision/scale`)
- `@Enumerated`: enum 매핑 (`EnumType.STRING` 권장)
- `@Temporal`: `Date/Calendar` 매핑 (`DATE`, `TIME`, `TIMESTAMP`)
- `@Lob`: BLOB/CLOB 매핑
- `@Transient`: DB 매핑 무시

---

## 4. 기본 키 매핑

### 전략
- 직접 할당: `@Id`
- 자동 생성: `@GeneratedValue`
    - `IDENTITY`: DB에 위임 (MySQL 등)
    - `SEQUENCE`: 시퀀스 오브젝트 사용 (Oracle 등)
    - `TABLE`: 키 생성 전용 테이블 사용 (성능 낮음)
    - `AUTO`: DB 방언에 따라 자동 선택

### 예제
```java
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY)
private Long id;
```

```java
@Id
@GeneratedValue(strategy = GenerationType.SEQUENCE,
    generator = "MEMBER_SEQ_GENERATOR")
@SequenceGenerator(
    name = "MEMBER_SEQ_GENERATOR",
    sequenceName = "MEMBER_SEQ",
    initialValue = 1,
    allocationSize = 1
)
private Long id;
```

**권장 방식**
- Long 타입 + 대체키 + 자동 생성 전략 사용

---

## 5. 실전 예제 - 요구사항 분석과 매핑

- **요구사항**
    - 회원은 상품을 주문할 수 있다.
    - 주문 시 여러 상품을 선택할 수 있다.

- **기능 목록**
    - 회원: 등록, 조회
    - 상품: 등록, 수정, 조회
    - 주문: 주문, 내역 조회, 취소

- **도메인 모델 분석**
    - 회원 ↔ 주문: 일대다
    - 주문 ↔ 상품: 다대다 → `주문상품` 중간 테이블로 풀어냄  
