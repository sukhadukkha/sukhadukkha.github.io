---
layout: single
title: "다양한 연관관계 매핑"
categories: [jpa]
tags: [jpa]
toc: true
author_profile: true
---

# 다양한 연관관계 매핑 (JPA)

## 목차
1. 연관관계 매핑시 고려사항 3가지
2. 다대일 (N:1)
3. 일대다 (1:N)
4. 일대일 (1:1)
5. 다대다 (N:M)
6. 실전 예제 - 다양한 연관관계 매핑
7. 주요 어노테이션 속성

---

## 1. 연관관계 매핑시 고려사항 3가지
- **다중성 (Multiplicity)**
    - 다대일: `@ManyToOne`
    - 일대다: `@OneToMany`
    - 일대일: `@OneToOne`
    - 다대다: `@ManyToMany`

- **방향 (Direction)**
    - 테이블: 외래 키 하나로 양쪽 조인 가능 (방향 개념 없음)
    - 객체: 참조 필드가 있는 쪽만 접근 가능
        - 한쪽만 참조 → 단방향
        - 양쪽 참조 → 양방향

- **연관관계의 주인 (Owner)**
    - 외래 키를 관리하는 참조 필드
    - 주인만 외래 키 등록/수정 가능
    - 반대편은 읽기 전용

---

## 2. 다대일 (N:1)

### 단방향
- 가장 많이 사용되는 연관관계
- `Member` → `Team`

### 양방향
- 외래 키가 있는 쪽(`Member`)이 주인
- 양쪽 참조 가능

---

## 3. 일대다 (1:N)

### 단방향
- 일(1) 쪽이 연관관계 주인
- 테이블 구조와 차이 존재 → 다른 테이블의 FK 관리
- `@JoinColumn` 반드시 필요
- 단점: 추가 `UPDATE SQL` 발생
- 권장: **다대일 양방향 매핑** 대체

### 양방향
- 공식적으로 존재하지 않음
- `@JoinColumn(insertable=false, updatable=false)` 로 읽기 전용 필드 사용

---

## 4. 일대일 (1:1)

- 양쪽 모두 1:1 관계
- **외래 키 위치 선택 가능**
    - 주 테이블에 FK
    - 대상 테이블에 FK

### 주 테이블에 FK
- 단방향: 다대일 단방향과 유사
- 양방향: 다대일 양방향과 유사 (주인: FK 있는 쪽)
- 장점: 조회 시 대상 존재 여부 확인 가능
- 단점: 값 없으면 FK에 `null` 허용

### 대상 테이블에 FK
- 단방향: JPA 지원 X
- 양방향: 가능
- 장점: 구조 변경(1:1 → 1:N) 시 유연
- 단점: 프록시 한계로 지연 로딩 불가, 항상 즉시 로딩

---

## 5. 다대다 (N:M)

- RDB는 다대다 불가 → 연결 테이블 필요
- 객체는 컬렉션으로 다대다 표현 가능

### @ManyToMany
```java
@ManyToMany
@JoinTable(name="MEMBER_PRODUCT")
private List<Product> products;
```
- 단방향, 양방향 모두 가능

### 한계
- 단순 연결 외에도 추가 정보(주문시간, 수량 등) 필요
- 실무에서는 사용 ❌

### 해결
- **연결 테이블을 엔티티로 승격**
- `@ManyToMany` 대신 → `@OneToMany`, `@ManyToOne` 조합 사용

---

## 6. 실전 예제
- 주문 ↔ 배송: **1:1** (`@OneToOne`)
- 상품 ↔ 카테고리: **N:M** (`@ManyToMany`)
- ERD 상 N:M 관계는 실제로 **1:N + N:1** 구조로 구현

---

## 7. 주요 어노테이션 속성

### @JoinColumn
- 외래 키 매핑 시 사용
- 주요 속성
    - `name`: 외래 키 컬럼명 (기본: 필드명 + 참조 PK)
    - `referencedColumnName`: 참조 대상 컬럼명 (기본: PK)
    - `foreignKey`: FK 제약조건 지정 (DDL 시에만 적용)
    - `unique`, `nullable`, `insertable`, `updatable` 등은 `@Column` 과 동일

### @ManyToOne
- 속성
    - `optional`: `false` → 항상 연관 엔티티 존재해야 함
    - `fetch`: 기본 `EAGER` (권장: `LAZY`)
    - `cascade`: 영속성 전이
    - `targetEntity`: 타입 정보 지정 (거의 사용 안함)

### @OneToMany
- 속성
    - `mappedBy`: 연관관계 주인 지정
    - `fetch`: 기본 `LAZY`
    - `cascade`: 영속성 전이
    - `targetEntity`: 타입 정보 지정 (거의 사용 안함)  
