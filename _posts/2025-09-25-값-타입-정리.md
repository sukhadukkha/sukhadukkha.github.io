---
layout: single
title: "ê°’ íƒ€ì… ì •ë¦¬"
categories: [jpa]
tags: [jpa, TIL]
toc: true
author_profile: true
---

# ğŸ“˜ JPA ê°’ íƒ€ì… ì •ë¦¬ (with ì˜ˆì‹œ)

## ëª©ì°¨
- [ê¸°ë³¸ê°’ íƒ€ì…](#1-ê¸°ë³¸ê°’-íƒ€ì…)
- [ì„ë² ë””ë“œ íƒ€ì…](#2-ì„ë² ë””ë“œ-íƒ€ì…-ë³µí•©-ê°’-íƒ€ì…)
- [ê°’ íƒ€ì…ê³¼ ë¶ˆë³€ ê°ì²´](#3-ê°’-íƒ€ì…ê³¼-ë¶ˆë³€-ê°ì²´)
- [ê°’ íƒ€ì…ì˜ ë¹„êµ](#4-ê°’-íƒ€ì…ì˜-ë¹„êµ)
- [ê°’ íƒ€ì… ì»¬ë ‰ì…˜](#5-ê°’-íƒ€ì…-ì»¬ë ‰ì…˜)
- [ì •ë¦¬](#6-ì •ë¦¬)
- [ì‹¤ì „ ì˜ˆì œ](#7-ì‹¤ì „-ì˜ˆì œ)

---

## 1. ê¸°ë³¸ê°’ íƒ€ì…

### ì •ì˜
- ë‹¨ìˆœíˆ ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ìë°” íƒ€ì…
- `int`, `double`, `Integer`, `Long`, `String` ë“±

### íŠ¹ì§•
- ì—”í‹°í‹°ì— ìƒëª…ì£¼ê¸°ë¥¼ ì˜ì¡´
- ê³µìœ  ë¶ˆê°€ (ë³µì‚¬í•´ì„œ ì‚¬ìš©í•´ì•¼ ì•ˆì „)

### ì˜ˆì‹œ
```java
@Entity
public class Member {
    @Id @GeneratedValue
    private Long id;

    private String name; // ê¸°ë³¸ê°’ íƒ€ì…
    private int age;     // ê¸°ë³¸ê°’ íƒ€ì…
}
```

- `íšŒì› ì—”í‹°í‹° ì‚­ì œ â†’ name, age í•„ë“œë„ í•¨ê»˜ ì‚­ì œ`

---

## 2. ì„ë² ë””ë“œ íƒ€ì… (ë³µí•© ê°’ íƒ€ì…)

### ì •ì˜
- ìƒˆë¡œìš´ ê°’ íƒ€ì…ì„ ì§ì ‘ ì •ì˜í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
- `@Embeddable` + `@Embedded`

### ì˜ˆì‹œ
```java
@Embeddable
public class Address {
    private String city;
    private String street;
    private String zipcode;

    protected Address() {} // ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜
    public Address(String city, String street, String zipcode) {
        this.city = city;
        this.street = street;
        this.zipcode = zipcode;
    }
}

@Entity
public class Member {
    @Id @GeneratedValue
    private Long id;

    private String name;

    @Embedded
    private Address homeAddress;
}
```

ğŸ“Œ **DB í…Œì´ë¸”**ì€ `Member` í•˜ë‚˜ë§Œ ìƒì„±ë¨. (AddressëŠ” ì»¬ëŸ¼ìœ¼ë¡œ ë…¹ì•„ë“¤ì–´ê°)

---

## 3. ê°’ íƒ€ì…ê³¼ ë¶ˆë³€ ê°ì²´

### ë¬¸ì œì 
- ê°ì²´ íƒ€ì…ì€ **ê³µìœ  ì°¸ì¡°** ë°œìƒ â†’ ë¶€ì‘ìš© ê°€ëŠ¥

```java
Address a = new Address("Seoul", "Street1", "11111");
Address b = a; // ì°¸ì¡° ê³µìœ 
b.setCity("Busan"); 
// aì˜ cityë„ Busanìœ¼ë¡œ ë°”ë€œ (ë¬¸ì œ!)
```

### í•´ê²° â†’ ë¶ˆë³€ ê°ì²´ ì„¤ê³„
```java
@Embeddable
public class Address {
    private final String city;
    private final String street;
    private final String zipcode;

    protected Address() {} // JPA ê¸°ë³¸ ìƒì„±ì
    public Address(String city, String street, String zipcode) {
        this.city = city;
        this.street = street;
        this.zipcode = zipcode;
    }
    // Setter ì—†ìŒ â†’ ë¶ˆë³€ ê°ì²´
}
```

---

## 4. ê°’ íƒ€ì…ì˜ ë¹„êµ

- **ë™ì¼ì„± ë¹„êµ (`==`)** â†’ ì¸ìŠ¤í„´ìŠ¤ ì°¸ì¡° ê°’
- **ë™ë“±ì„± ë¹„êµ (`equals()`)** â†’ ì‹¤ì œ ê°’ ë¹„êµ

### ì˜ˆì‹œ
```java
Address a = new Address("Seoul", "Street", "11111");
Address b = new Address("Seoul", "Street", "11111");

System.out.println(a == b);        // false (ì°¸ì¡° ë¹„êµ)
System.out.println(a.equals(b));   // true  (ê°’ ë¹„êµ) â†’ equals() ì˜¤ë²„ë¼ì´ë“œ í•„ìš”
```

ğŸ“Œ `equals()`ì™€ `hashCode()` ë°˜ë“œì‹œ ì¬ì •ì˜í•´ì•¼ í•¨.

---

## 5. ê°’ íƒ€ì… ì»¬ë ‰ì…˜

### ì •ì˜
- ê°’ íƒ€ì…ì„ í•˜ë‚˜ ì´ìƒ ì €ì¥í•  ë•Œ ì‚¬ìš©
- ë³„ë„ í…Œì´ë¸” í•„ìš” (`@ElementCollection`, `@CollectionTable`)

### ì˜ˆì‹œ
```java
@Embeddable
public class Address {
    private String city;
    private String street;
    private String zipcode;
}

@Entity
public class Member {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @ElementCollection
    @CollectionTable(name = "address_history",
                     joinColumns = @JoinColumn(name = "member_id"))
    private List<Address> addressHistory = new ArrayList<>();
}
```

ğŸ“Œ DBì—ì„  `Member`ì™€ `address_history` ë‘ ê°œì˜ í…Œì´ë¸” ìƒì„±ë¨.

### ì œì•½ì‚¬í•­
- ë³€ê²½ ì¶”ì  ì–´ë ¤ì›€
- ê°’ ë³€ê²½ ì‹œ ì»¬ë ‰ì…˜ ì „ì²´ ì‚­ì œ í›„ ë‹¤ì‹œ ì €ì¥

### ëŒ€ì•ˆ
- ì¼ëŒ€ë‹¤ ê´€ê³„ ì—”í‹°í‹°ë¡œ ì„¤ê³„
```java
@Entity
public class AddressEntity {
    @Id @GeneratedValue
    private Long id;

    @Embedded
    private Address address;
}
```

---

## 6. ì •ë¦¬

| êµ¬ë¶„         | ì—”í‹°í‹° íƒ€ì… | ê°’ íƒ€ì… |
|--------------|-------------|---------|
| ì‹ë³„ì       | O           | X       |
| ìƒëª…ì£¼ê¸°     | ë…ë¦½ì  ê´€ë¦¬ | ì—”í‹°í‹° ì˜ì¡´ |
| ê³µìœ          | ê°€ëŠ¥        | ë³µì‚¬ ì‚¬ìš© ê¶Œì¥ |
| ë³€ê²½ ì¶”ì     | O           | ì–´ë ¤ì›€ |
| ì„¤ê³„ ë°©ì‹    | ì§€ì† ì¶”ì  í•„ìš” | ë‹¨ìˆœ ê°’ í‘œí˜„ |

âš ï¸ **ì—”í‹°í‹°ì™€ ê°’ íƒ€ì… í˜¼ë™ ê¸ˆì§€**
- ì¶”ì /ë³€ê²½ì´ í•„ìš”í•˜ë©´ ì—”í‹°í‹°
- ë‹¨ìˆœ ê°’ í‘œí˜„ì´ë©´ ê°’ íƒ€ì…

---

## 7. ì‹¤ì „ ì˜ˆì œ

### ì˜ˆì‹œ: íšŒì› + ê·¼ë¬´ê¸°ê°„ + ì£¼ì†Œ
```java
@Embeddable
public class Period {
    private LocalDate startDate;
    private LocalDate endDate;

    public boolean isWork() {
        return startDate != null && endDate == null;
    }
}

@Entity
public class Member {
    @Id @GeneratedValue
    private Long id;

    private String name;

    @Embedded
    private Period workPeriod;

    @Embedded
    private Address homeAddress;
}
```
