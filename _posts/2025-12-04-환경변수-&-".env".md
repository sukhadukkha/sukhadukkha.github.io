---
layout: single
title: "환경 변수 & .env & Arguments"
categories: [docker]
tags: [docker]
toc: true
author_profile: true
---

## 환경변수 .env

- 이게 뭘까?
- 도커는 Arguments와 환경 변수를 지원한다.
- Arguments 
  - 이는 Dockerfile에서 특정 Dockerfile 명령으로 변수를 설정할 수 있다.
  - --build-arg
- 환경변수
  - 환경변수는 Arguments처럼 Dockerfile 내부에서 사용할 수 있다.
  - 하지만 이 변수는 실행 중인 애플리케이션의 코드에서도 사용할 수 있다.
  - ENV , --env
- **이 둘을 사용하면 유연한 이미지와 컨테이너를 만들 수 있다.**
- 컨테이너와 이미지에 모든 것을 하드코딩 할 필요가 없어진다.

```dockerfile
FROM node

WORKDIR /app

COPY package.json /app

RUN npm install

COPY . /app

ENV PORT 80       # PORT라는 환경변수 이름 설정 + 80이라는 값을 강제하지 않음

EXPOSE $PORT      # $표시로 도커에게 뒤의 단어로 인수 or 환경 변수를 참조하고 있다고 알림

CMD [ "npm","start" ]
```
```
  app.listen(process.env.PORT);
```

- docker run -d --name feedback-app -p **3000:8000 --env(e) PORT=8000** --rm \ 
-v feedback:/app/feedback \
-v /app/node_modules \
-v /app/temp \
-v "/Users/jihopark/DevOpsStudy/Docker/data-volumes-01-starting-setup:/app:ro" \
feedback-node:env
- 여러개의 -env 추가 가능
- 환경 변수가 포함된 파일을 지정할 수도 있다.
- docker run -d --name feedback-app -p **3000:8000 --env-file ./.env**  --rm \
  -v feedback:/app/feedback \
  -v /app/node_modules \
  -v /app/temp \
  -v "/Users/jihopark/DevOpsStudy/Docker/data-volumes-01-starting-setup:/app:ro" \
  feedback-node:env
- 파일 생성 및 지정의 이점은 docker run 명령어에서 값을 지정하는게 아닌, 파일에서 값을 변경할 수 있다는 점이다.
- 환경 변수의 이점은 변수가 하드코딩 된 값으로 제한되지 않고, docker run을 할 때 지정할 수 있다는 것이다.
```
PORT=8000  # PORT = 8000 처럼 띄어쓰기 사용 하면 안됨! 밑의 에러 발생
docker: invalid env file (./.env): variable 'PORT ' contains whitespaces
```

## Arguments

- 포트의 디폴트 값은 여전히 80으로 하드 코딩 되어있다!
- 이 값 또한 유연하게 만들고 싶다면?

```dockerfile
FROM node

ARG DEFAULT_PORT=80

WORKDIR /app

COPY package.json /app

RUN npm install

COPY . /app

ENV PORT $DEFAULT_PORT

EXPOSE $PORT

CMD [ "npm","start" ]
```

- `최적화 : DEFAULT_PORT가 변경될때마다 npm install을 하면 시간이 오래걸리기 때문에 ARG 레이어를 밑에 배치`
```dockerfile
FROM node

WORKDIR /app

COPY package.json /app

RUN npm install

COPY . /app

ARG DEFAULT_PORT=80

ENV PORT $DEFAULT_PORT

EXPOSE $PORT

CMD [ "npm","start" ]
```

- docker build -t feedback-node:web-app . 
- docker build -t feedback-node:dev **--build-arg DEFAULT_PORT=8000** .
- 같은 Dockerfile로 2개의 이미지를 만들었다. `하지만 다른 포트번호를 사용한다.`
- docker inspect \<image_id\>를 통해 이미지 별 EXPOSE 포트 확인
```
 "Config": {
            "ExposedPorts": {
                "8000/tcp": {}
            },
            "Env": [
                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
                "NODE_VERSION=25.2.1",
                "YARN_VERSION=1.22.22",
                "PORT=8000"
                
                
   "Config": {
            "ExposedPorts": {
                "80/tcp": {}
            },
            "Env": [
                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
                "NODE_VERSION=25.2.1",
                "YARN_VERSION=1.22.22",
                "PORT=80"               
```

