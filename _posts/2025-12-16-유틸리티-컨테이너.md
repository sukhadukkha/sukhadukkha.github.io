---
layout: single
title:  "유틸리티 컨테이너"
categories: [docker]
tags: [docker]
toc: true
author_profile: true
---

## 유틸리티 컨테이너란?

- 특정 환경만 포함하고 제공하는 컨테이너
- 일반적으로 애플리케이션을 실행하는 것 외에 Docker로 할 수 있는 일

## 왜 사용할까? 

- 프로젝트를 컨테이너에 넣을 수 있지만, 초기 환경 구성에는 npm이라는 명령을 실행시키기 위해서 Node.js 가 필요하다.
- 이는 Node.js를 설치해야한다는 뜻이다.
- 이 부분을 유틸리티 컨테이너가 도와준다.

## 사용은? (명령어들) 

- docker exec -it \<컨테이너 이름\> -> 실행 중인 컨테이너 내에서 특정 명령 실행 가능
- docekr run -it node npm init 
- Dockerfile로 빌드된 이미지를 통해 사용자가 이 이미지에 대한 모든 권한을 가질 수 있도록 CMD는 제외
```dockerfile
FROM node:14-alpine

WORKDIR /app
```
- 이 Dockerfile로 만든 이미지에 npm init을 전달 및 바인드 마운트를 통해 컨테이너 내부의 변경 사항이 호스트 머신까지 영향을 끼칠 수 있도록 설정
  - docker run -it -v /Users/jihopark/Udemy/DockerStudy/Docker/util-container:/app node-util:latest npm init
  - 이렇게 함으로써 호스트 머신에 모든 다른 도구를 설치하지 않고도 호스트 머신에 영향을 끼치는 유틸리티 컨테이너 사용 가능
  - 이렇게하면 Node.js를 호스트머신에 설치 할 필요가 없어진다!

```dockerfile
FROM node:14-alpine

WORKDIR /app

ENTRYPOINT [ "npm" ]
```

- ENTRYPOINT를 설정해두면, 이제 docker run에 npm을 입력 할 필요가 없어진다.
  - docker run -it -v /Users/jihopark/Udemy/DockerStudy/Docker/util-container:/app mynpm init
  - docker run -it -v /Users/jihopark/Udemy/DockerStudy/Docker/util-container:/app mynpm install
  -  docker run -it -v /Users/jihopark/Udemy/DockerStudy/Docker/util-container:/app mynpm install express --save
- **명령이 완료되면 컨테이너는 종료된다.**


### 하지만 이렇게 터미널에 긴 명령을 입력하기는 번거롭다!(해결책)

- Docker compose 사용
```dockerfile
services:
  npm:
    build: ./
    stdin_open: true
    tty: true
    volumes:
      - ./:/app
```
- docker compose run npm init 
  - npm이 service 이름이므로, npm을 사용한다.
  - docker compose run \<service name\>은 docker compose 파일에서 단일 서비스를 실행한다.
  - 서비스 이름을 넣었으면 그 뒤, Dockerfile에 있는 ENTRYPOINT 다음 추가되어야 할 명령 입력한다.
  - docker compose run 은 docker compose down과 달리 컨테이너가 종료되면 자동으로 삭제되지 않는다.
  - docker compose run --rm을 통해 해결한다.