---
layout: single
title:  "Docker 핵심 요약 정리"
categories: [docker]
tags: [docker]
toc: true
author_profile: true
---


## 컨테이너와 이미지

- `컨테이너는 코드와 그 코드를 실행하는데 필요한 환경을 포함하는 박스다.`
- 하나의 컨테이너에서는 하나의 일만 실행한다.(웹서버, 프론트엔드, DB ...)
- 컨테이너의 데이터는 볼륨이 없다면 종료될 때마다 사라진다.
- 이미지는 컨테이너를 만들 때 필요한 도구이다.
- 컨테이너는 이미지에 의해 생성된다.
- 이미지는 Dockerfile로 만들거나, Docker Hub에서 가져온다.
- **이미지는 컨테이너의 청사진 역할을 한다.(코드와 환경 포함)**
- 이미지에서 하나의 레이어만 변경된다면, 다른 레이어들은 캐시를 사용하여 재 실행 되지 않는다.

## Docker 주요 Command

![커맨드](/assets/images/keyCommand.png)

## Data, Volumes, Network

- **컨테이너 내부에서 생성한 모든 데이터는 컨테이너가 종료되면 손실된다.**
- 바인드마운트, 익명볼륨, Named 볼륨으로 해결 가능하다.
- 각각의 사용법과 차이점
  - 바인드마운트 : 호스트에서 파일 수정 시 컨테이너에 즉시 반영, -v ./backend:/app
  - 익명 볼륨 : 컨테이너 중지되어도 데이터 남지만, 삭제된다면 같이 사라짐, 특정 하위 폴더가 덮어씌워지는 것을 방지하기 위한 용도로 많이 사용, -v /app/data
  - Named 볼륨 : 컨테이너를 삭제해도 데이터 사라지지 않는다. docker volume rm을 통해 삭제 가능, -v data-vol:/data/db
- 네트워크 : 네트워크를 생성하고, 컨테이너들을 같은 네트워크 상에 넣어두면 Docker가 스스로 IP 주소가 아닌 컨테이너 이름을 주소로 서로 통신

## Docker-Compose

- Docker를 통해 컨테이너를 실행하려면 명령이 길어지는 상황 발생
- 이를 해결하기 위해 컨테이너 시작 구성을 구성 파일에 넣어두는 docker-compose.yml 파일 생성
- docker compose up 으로 실행, docker compose down 으로 중지


## 로컬 vs 리모트

- 로컬 개발 환경에서의 Docker는 개발을 매우 편리하게 해준다.
- 로컬에서 작동하는 컨테이너들은 리모트 환경에서도 잘 작동한다.
    - 컨테이너를 위한 이미지에 모든 것이 담겨있기 때문이다.

## Deployment

- 바인드 마운트는 배포 환경에서는 사용하지 않는다.
- 배포 환경에서는 하나의 컴퓨터가 아닌 여러 컴퓨터가 필요할 수 있다.
  - 배포하려는 애플리케이션의 요구사항과 트래픽 등 모든 사항에 따라 하나의 컴퓨터에서 여러 컨테이너를 실행 할 수도 있다.
- Multi-stage builds
  - 빌드 과정에서는 무거운 도구들이 필요하기 때문에, 첫 번째 단계에서 빌드를 하고, 최종 결과물(빌드된 파일)만 가벼운 두 번째 이미지로 복사하여 나머지 무거운 도구들은 버린다.
  - 이를 통해 하나의 Dockerfile 안에서 전체 흐름(빌드 -> 테스트 -> 배포)을 관리할 수 있다.
  - CI/CD 배포 속도가 향상된다.
  - 보안이 강화된다.(최종 이미지에는 필요한 실행 파일만 남기기 때문에 훨씬 안전해짐)
- 내가 모든 책임을 지지 않아도 되는 사용 편의성을 늘려주는 서비스들이 많다. (RDS, ECS ...)
