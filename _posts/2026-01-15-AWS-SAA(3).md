---
layout: single
title:  "AWS SAA 준비(IP, VPC, Placement Groups, ENI, EC2 Hibernate)"
categories: [AWS SAA]
tags: [AWS SAA]
toc: true
author_profile: true
---

## Private IP, Public IP, Elastic IP

- **Private IP**
  - AWS VPC(가상 네트워크) 내부에서만 통용되는 주소
  - 인스턴스를 생성하면 무조건 하나 이상 할당
  - 인터넷을 통해 접속 불가능, VPC 내부의 다른 자원(EC2, RDS 등)과 통신할 때 사용
  - 인스턴스를 중지했다가 다시 시작해도 변하지 않고 유지된다.
  - 무료
- **Public IP**
  - 인터넷(외부)에서 내 인스턴스에 접속할 수 있도록 해주는 주소
  - `동적 IP: 인스턴스를 중지하고 다시 시작하면 주소가 바뀐다.` (매번 새로운 주소를 AWS 풀에서 할당받기 때문)
  - 인스턴스를 종료하면 AWS로 다시 반납된다.
  - 비용 유료
- Elastic IP(EIP)
  - 내 계정에 고정적으로 할당되는 정적 IP
  - 인스턴스를 종료했다가 다시 시작해도 IP 주소가 바뀌지 않는다.
  - 외부에 알려진 내 주소를 고정하기 위해 사용
  - 필요에 따라 A 인스턴스에서 B 인스턴스로 주소를 옮겨갈 수 있다.
    - A 인스턴스(1.2.3.4)가 고장난다면 B 인스턴스를 가동하고, 1.2.3.4 라는 주소를 A에서 떼어내어 B에 옮긴다.
    - 사용자는 그대로 1.2.3.4에 요청 보내도 지장이 없다.
  - 유료 / EIP는 Release 하지 않으면 비용 계속 나감

## VPC(Virtual Private Cloud)

- AWS 위에 나만을 위해 만든 가상 네트워크
- 예시
  - VPC (아파트 단지): 나만 사용할 수 있는 사적인 공간입니다. 다른 사람의 VPC와는 완전히 격리되어 있습니다.
  - Subnet (동/구역): 단지 내부를 용도에 따라 나눕니다.
    - Public Subnet (상가): 누구나 들어올 수 있는 구역. 웹 서버(EC2)를 둡니다. / 인터넷 게이트웨이로 향하는 경로가 라우팅 테이블에 있는 서브넷
    - Private Subnet (생활관): 입주민만 들어오는 구역. 중요한 데이터베이스(RDS)를 둡니다.
  - Internet Gateway (단지 정문): 이 문이 있어야 단지 내부 사람들이 인터넷(외부)으로 나갈 수 있고, 외부 사람도 들어올 수 있습니다.
  - Security Group (현관 도어락): 각 인스턴스마다 어떤 포트(22번, 80번 등)를 열어줄지 결정합니다.
- VPC 핵심 구성요소 
  - CIDR 블록: VPC가 가질 수 있는 IP 주소의 범위(예: 10.0.0.0/16) / 총 65,636개의 주소 사용한다는 선언 / 16.0 까지는 고정, 뒤의 0.0 에서 256 * 256 = 65,536
  - Route Table(이정표): 네트워크 트래픽이 어디로 가야할지 알려주는 지도. IP 주소들이 정리되어있음
  - NAT Gateway (대리인): Private Subnet에 있는 서버들이 외부 인터넷에서 보안 패치를 다운로드받고 싶을 때, 자신의 정ㅊ는 숨기면서 밖으로 나갈 수 있게 도와주는 통로, 밖에서 들어올 수는 없음.
  

## Placement Groups

- **배치 그룹(Placement Groups)는 EC2 인스턴스들을 물리적인 하드웨어(서버 랙)에 어떤 방식으로 배치할지 결정하는 전략.**
  - 우리 팀 컴퓨터들을 한 곳에 몰아넣을까, 아니면 고장 날 걸 대비해서 멀리 떨어뜨려 놓을까?
- **Cluster Placement Group**
  - 단일 가용 영역(AZ) 내에서 인스턴스들을 물리적으로 아주 가까운 위치(동일한 랙)에 배치합니다.
  - 인스턴스 간의 네트워크 지연 시간(Latency)이 매우 낮고 대역폭(Throughput)이 매우 높습니다.
  - 해당 랙이나 하드웨어에 장애가 생기면 그룹 내 모든 인스턴스가 동시에 영향을 받을 수 있습니다. (가용성 낮음)
  - 고성능 컴퓨팅(HPC), 빅데이터 분석, 지연 시간에 민감한 애플리케이션에 사용.
- **Spread Placement Group**
  - 각 인스턴스를 서로 다른 물리적 하드웨어(서버 랙)에 하나씩 엄격하게 떨어뜨려 놓습니다.
  - 하나의 하드웨어 랙이 고장 나도 다른 인스턴스들은 안전합니다. 최대 가용성을 보장합니다.
  - 가용 영역(AZ)당 최대 7개의 인스턴스만 생성할 수 있다는 강력한 제한이 있습니다.
  - 매우 중요한 소수의 개별 인스턴스(DB 마스터와 슬레이브, 파일럿 서비스 등) 관리에 사용.
- Partition Placement Group
  - 인스턴스들을 '파티션'이라는 논리적 그룹으로 나눕니다. 각 파티션은 서로 하드웨어를 공유하지 않습니다.
  - 클러스터의 성능과 분산의 안정성을 절충한 형태입니다. 수백 개의 인스턴스를 띄울 수 있어 규모가 큰 작업에 적합합니다.
  - HDFS, HBase, Cassandra, Kafka 같은 대규모 분산 및 복제 워크로드에 사용.
- AWS 에서 그룹을 생성하고(Placement Groups), 인스턴스를 생성할 때 그룹을 선택할 수 있다(Placement group name).

## ENI(Elastic Network Interface)

- **EC2 인스턴스에 꽂는 가상 랜카드다.**
  - 우리가 컴퓨터 본체에 랜선을 꽂기 위해 랜카드가 필요한 것처럼, AWS의 가상 컴퓨터인 EC2가 네트워크와 통신하기 위해서는 ENI가 꼭 필요하다.
- ENI가 포함하고 있는 정보
  - ENI 하나에는 다음과 같은 네트워크 정보들이 묶여있다.
  - Primary Private IPv4: 필수적으로 하나는 가집니다.
  - Secondary Private IPv4: 여러 개의 사설 IP를 가질 수도 있습니다.
  - Elastic IP (EIP): 공인 IP 하나를 연결할 수 있습니다.
  - Public IP: (선택 사항)
  - MAC 주소: 하드웨어 고유 식별 번호.
  - Security Groups: 해당 랜카드에 적용될 보안 규칙.
- ENI의 핵심 특징
  - 독립된 객체: ENI는 인스턴스와 별개로 존재할 수 있습니다. 즉, 인스턴스에서 떼어냈다가(Detach) 다른 인스턴스에 다시 붙이는(Attach) 것이 가능합니다.
  - AZ(가용 영역) 종속: ENI는 특정 서브넷 내에 생성되므로, 해당 서브넷이 속한 AZ 내에서만 이동이 가능합니다. (A 구역의 ENI를 B 구역 인스턴스에 붙일 수는 없습니다.)
  - 여러 개 부착 가능: 하나의 EC2 인스턴스에 여러 개의 ENI를 꽂을 수 있습니다.
- 왜 ENI를 여러개 사용할까?
  - 네트워크 분리 (Dual-Homing)
    - ENI 1번: 일반 유저들이 접속하는 서비스용 네트워크. / ENI 2번: 관리자가 접속하여 백업이나 모니터링을 하는 내부 관리용 네트워크.
    - 이렇게 용도별로 네트워크 망을 분리하여 보안을 강화할 때 사용합니다.
  - 저비용 장애 조치
    - A 서버에 문제가 생기면, 해당 서버의 ENI(사설 IP와 설정들이 담긴)를 떼서 미리 준비한 B 서버에 바로 꽂아버립니다. 그러면 네트워크 설정 변경 없이 서비스를 이어갈 수 있습니다.
- EIP, ENI
  - Elastic IP: 인터넷에서 접속하기 위한 '공인 IP 주소' 그 자체입니다.
  - ENI: IP 주소를 포함하여 MAC 주소, 보안 그룹 등을 모두 담고 있는 **'네트워크 장치(랜카드)'**입니다


## EC2 Hibernate

- 인스턴스를 완전히 끄는 대신 RAM 상태를 그대로 보존한채로 일시 중지 하는 기능
- 작동 원리
  - RAM 상태 저장: 인스턴스 RAM에 들어있는 데이터를 EBS 루트 볼륨에 파일 형태로 저장한다.
  - 인스턴스 정지: 데이터 저장이 완료되면 인스턴스가 중지 상태가 됩니다. 이때 컴퓨팅 비용은 청구되지 않는다.
  - 재개: 인스턴스를 다시 시작하면 EBS에 저장했던 RAM 데이터를 다시 메모리로 불러온다.
  - 복구: 부팅 과정을 처음부터 거치지 않고, 중단했던 시점부터 서비스를 재개한다.
- 주요 사용 사례
  - 애플리케이션 초기화 시간이 긴 경우
  - 상태 유지가 필요한 작업
- SAA 출제 문제
  - EBS 지원 인스턴스: 루트 볼륨이 반드시 EBS여야 합니다. (인스턴스 스토어 사용 불가)
  - EBS 암호화(Encryption) 필수: RAM 데이터가 하드 디스크(EBS)에 쓰여지기 때문에 보안을 위해 루트 볼륨이 반드시 암호화되어 있어야 합니다.
  - 용량 확보: EBS 루트 볼륨의 크기는 [OS 크기 + RAM 크기]를 수용할 수 있을 만큼 충분히 커야 합니다.
  - RAM 크기 제한: 현재는 RAM 용량이 150GB 미만인 인스턴스에서만 지원됩니다.
  - 인스턴스 타입: 모든 타입이 지원되는 것은 아니며, 주로 C, M, R 시리즈의 특정 세대에서 지원됩니다.