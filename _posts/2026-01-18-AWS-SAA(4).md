---
layout: single
title:  "AWS SAA 준비(EBS, AMI, EC2 Instance Store, EFS )"
categories: [AWS SAA]
tags: [AWS SAA]
toc: true
author_profile: true
---


## EBS(Elastic Block Storage)

- EBS는 EC2 인스턴스에 장착해서 사용하는 가상 하드디스크다.
- EBS의 핵심 특징
    - 물리적으로 꽂혀있는것이 아닌, 네트워크로 연결된 저장소이다. 그러므로 인스턴스와 별개로 존재하며 탈부착이 자유롭다.
    - 특정 AZ 내에서 생성된다. 다른 AZ로 옮기려면 스냅샷을 사용해야한다.
    - EC2 인스턴스를 종료해도 EBS는 삭제되지 않도록 설정할 수 있다. (기본 값은 인스턴스를 만들 때 루트 볼륨의 경우 종료하면 삭제되게 되지만, 인스턴스 생성 시 옵션으로 변경 가능하다.)
- 한 대의 EC2에 여러 개의 EBS 부착(1:N)
  - 가능
  - C드라이브에 운영체제, D드라이브에 DB 데이터 저장, E드라이브에 로그 파일 저장하는 식으로 분리해서 관리 가능
- 하나의 EBS를 여러 대의 EC2가 공유(N:1)
  - 기본적으로 안됨
  - 하지만 Multi-Attach 기능을 사용하면 물리적인 연결은 가능하다.
  - 조건: 오직 Provisioned IOPS SSD(io1, io2) 타입만 가능하다.
  - 한계: 단순히 연결만 해줄 뿐, 데이터가 깨지지 않게 관리하는 '클러스터용 파일 시스템' 설정은 사용자가 직접 노가다로 세팅해야 한다. 그래서 실무에서 단순 공유 목적으로는 잘 쓰지 않는다.
- 진짜 공유가 필요할때는? / 여러 서버 간 파일 공유가 목적이라면? 
  - EFS 사용

### EBS Snapshots

- 특정 시점의 EBS 볼륨 상태를 그대로 복사하여 저장하는 백업 서비스다.
- 첫 번째 백업 이후에는 변경된 데이터 블록만 저장한다.
  - Snapshot 1 (초기): 볼륨 전체 데이터를 저장합니다. (예: 10GB)
  - Snapshot 2 (변경): 첫 번째 백업 이후 추가되거나 수정된 데이터만 저장합니다. (예: 2GB)
  - Snapshot 3 (추가 변경): 두 번째 백업 이후 바뀐 부분만 저장합니다.
- **EBS Snapshot Archive**
  - 평소에 잘 쓰지 않는 데이터를 저렴한 창고로 옮겨두는 것이다.
  - Standard Tier: 평소에 스냅샷이 저장되는 공간 / 자주 꺼내 쓰는 데이터를 위한 공간 / 복구가 매우 빠름
  - Archive Tier: 보관만 해야하는 데이터를 위한 창고 / 거의 안꺼내 보는 데이터를 위한 공간 / 데이터를 다시 쓰기 위해 Standard 계층으로 꺼내 오는데 24~72시간 소요 / 저자빙요 저렴하지만 데이터를 꺼낼 때 GB당 비용 추가 발생
- Recycle Bin
  - 실수로 지운 데이터를 살리는 것
    - Retention Rules를 설정해두면 스냅샷을 삭제했을 때 즉시 사라지지 않고 휴지통에 설정한 기간 동안 머무른다.
    - 휴지통에 있는 동안에도 일반 스냅샷과 동일한 비용이 청구된다.


## AMI(Amazon Machine Image)

- EC2 인스턴스를 실행하는 데 필요한 모든 소프트웨어 설정(운영체제, 애플리케이션 서버, 애플리케이션 등)을 담고있는 설계도이다.
  - 이 컴퓨터를 어떻게 부팅하고 실행할 것인가에 대한 모든 정보가 포함된 패키지다.
- 구성요소
  - 루트 볼륨 템플릿: 운영체제와 애플리케이션이 설치된 EBS 스냅샷
  - 실행 권한: 이 AMI를 누가 사용할 수 있는지
  - 블록 디바이스 매핑: 인스턴스가 실행될 때 어떤 EBS 볼륨들을 추가로 붙일 것인지에 대한 정의
- AMI의 종류
  - AWS Marketplace AMI: SAP, Oracle, 및 보안 솔루션 등 타사 소프트웨어가 미리 설치된 이미지 (유료 또는 무료).
  - Community AMI: 다른 사용자들이 만들어 공유한 무료 이미지.
  - My AMI (Custom AMI): 내가 직접 만든 이미지. 내가 세팅한 백엔드 환경(Java, Spring Boot, Docker 등)을 그대로 복제해서 여러 대의 서버를 띄울 때 사용합니다.
- **SAA 시험용 핵심 포인트**
  - 지역(Region) 종속성: AMI는 특정 리전에 귀속됩니다. 서울 리전에서 만든 AMI를 도쿄에서 바로 쓸 수는 없습니다. 'Copy AMI' 기능을 이용해 도쿄로 복사해야 합니다.
  - 계정 간 공유: 내 AMI를 다른 친구의 AWS 계정이나 회사 계정으로 공유할 수 있습니다.
  - 오토 스케일링(ASG)의 핵심: 서버 부하가 늘어나서 컴퓨터를 자동으로 늘릴 때(Auto Scaling), 어떤 서버를 복제할지 결정하는 기준이 바로 AMI입니다. 
  - 예: "내가 미리 세팅해둔 'BackEnd-V1' AMI를 사용해서 서버 3대 더 띄워줘!"
- Instance 우클릭 -> Create Image를 통해 AMI 생성 가능


## EC2 Instance Store

- EC2 인스턴스가 실행되는 물리적 서버에 직접 부착된 하드디스크다.
- 네트워크를 거쳐 연결되는 EBS와 달리, 본체에 바로 연결 되어있기 때문에 속도가 압도적으로 빠르다.
- 하지만 데이터가 쉽게 사라진다.
- 핵심 특징
  - 물리적 부착: 서버 본체에 직접 꽂혀 있어 I/O 지연 시간(Latency)이 거의 없고 대역폭이 매우 높습니다.
  - 휘발성 (Ephemeral): 인스턴스를 중지(Stop)하거나 종료(Terminate)하면 저장된 데이터가 영구적으로 삭제됩니다. (하이버네이트도 불가능합니다.)
  - 수명: 오직 인스턴스가 실행 중인 동안에만 데이터가 보존됩니다. 인스턴스를 '재부팅(Reboot)'할 때는 데이터가 남지만, '중지 후 다시 시작'할 때는 물리 서버가 바뀔 수 있기 때문에 데이터가 사라집니다.
- 왜 사용할까?
  - 임시 데이터 저장: 캐시(Cache), 버퍼, 스크래치 패드.
  - 복제된 데이터: 데이터가 여러 서버에 분산 저장되어 있어, 한 대의 데이터가 날아가도 다른 곳에서 복구할 수 있는 경우 (예: Hadoop Cluster, NoSQL 데이터베이스).
  - 비디오 렌더링/인코딩: 작업 중인 임시 파일을 빠르게 읽고 써야 할 때.
- SAA 시험용 포인트
  - 질문: "매우 높은 IOPS가 필요하고, 데이터가 유실되어도 다른 노드에서 복구할 수 있는 아키텍처라면?"
  - 정답: Instance Store (성능이 최우선이므로)
  - 질문: "인스턴스를 중지(Stop)했는데 다시 켜니 데이터가 다 사라졌습니다. 원인이 무엇인가요?"
  - 정답: 루트 볼륨이나 데이터 볼륨이 Instance Store로 설정되어 있었기 때문입니다.

## EBS Volume Types

- 계열 : SSD 기반 볼륨 (성능/지연 시간 중시) / HDD 기반 볼륨 (처리량/비용 중시)
- SSD 기반 볼륨
  - 작은 I/O를 자주 처리하는 트랜잭션 워크로드(웹 서버, 데이터베이스 등)에 적합하다.
  - gp3 (General Purpose SSD - 최신)
    - 특징: 가성비가 가장 좋습니다. 용량과 관계없이 IOPS와 처리량(Throughput)을 별도로 설정할 수 있습니다.
    - 기본 제공: 용량에 상관없이 기본 3,000 IOPS와 125 MiB/s 처리량을 제공합니다.
    - 용도: 가상 데스크톱, 낮은 지연 시간이 필요한 앱, 개발/테스트 환경.
  - gp2 (General Purpose SSD - 이전 세대)
    - 특징: 용량에 비례해서 IOPS가 결정됩니다 (1GB당 3 IOPS). 작은 용량에서는 성능이 낮아지는 단점이 있습니다.
    - 용도: gp3가 나오기 전의 표준. 현재는 gp3 사용을 권장합니다.
  - io1 / io2 (Provisioned IOPS SSD)
    - 특징: 극강의 성능과 일관성이 필요할 때 사용합니다.
    - 특수 기능: Multi-Attach 지원 (하나의 EBS를 여러 EC2에 동시에 연결).
    - 용도: 대규모 데이터베이스(SAP, Oracle, NoSQL), 초저지연이 필수인 핵심 비즈니스 앱.
- HDD 기반 볼륨
  - 큰 데이터를 한 번에 읽고 쓰는 작업(빅데이터, 로그 처리)에 적합하며, 부팅 볼륨으로 사용할 수 없다.
  - st1 (Throughput Optimized HDD)
    - 특징: 처리량(MiB/s)이 중요합니다. 값이 싸면서 큰 데이터를 빠르게 처리합니다.
    - 용도: 빅데이터 분석(Hadoop), 데이터 웨어하우스(DW), 로그 처리.
  - sc1 (Cold HDD)
    - 특징: 가장 저렴한 볼륨입니다. 자주 접근하지 않는 데이터에 최적화되어 있습니다.
    - 용도: 아카이브용 데이터, 접근 빈도가 매우 낮은 파일 저장.
  
  
### EBS Multi-Attach

- 하나의 EBS 볼륨을 동일한 AZ 내에 있는 여러 개의 EC2 인스턴스에 동시에 연결할 수 있게 해주는 기능
- 핵심 특징 및 제약 사항
  - 볼륨 타입: 모든 EBS에서 되는 것이 아니다. 오직 Provisioned IOPS SSD (io1 또는 io2) 볼륨에서만 지원된다.
  - 가용 영역(AZ): 반드시 같은 AZ에 있는 인스턴스들끼리만 공유할 수 있다.
  - 연결 개수: 하나의 볼륨당 최대 16개의 인스턴스까지 연결 가능하다.
- 주의사항
  - 데이터 오염 위험: 일반적인 파일 시스템(ext4, XFS, NTFS 등)은 여러 컴퓨터가 동시에 한 디스크에 데이터를 쓴다는 가정을 하지 않습니다. 만약 두 서버가 동시에 같은 곳에 쓰려고 하면 데이터가 깨진다.
  - 해결책: Multi-Attach를 제대로 쓰려면 클러스터 인식 파일 시스템(Cluster-aware File System)을 사용해야 합니다. (예: GFS2, OCFS2, Veritas InfoScale 등)

## EBS Encryption

- EBS 암호화는 AWS의 키 관리 서비스인 KMS와 연동하여 작동한다. 성능에 영향을 거의 주지 않으면서 강력한 보안을 제공한다.
- 특징
  - 투명한 암호화: 인스턴스와 볼륨 사이의 데이터 이동 시 암호화/복호화가 자동으로 이루어지므로 애플리케이션 코드를 수정할 필요가 없다.
  - 성능 유지: EC2 인스턴스의 CPU가 아닌 별도의 하드웨어를 사용하여 암호화를 처리하기 때문에 지연 시간(Latency)에 미치는 영향이 매우 적다.
  - KMS 연동: AES-256 알고리즘을 사용하며, AWS가 관리하는 키(AWS Managed Key) 또는 사용자가 직접 만든 키(Customer Managed Key)를 선택할 수 있다.
- SAA 시험 단골 문제 : 암호화 상태 변경하기
  - 이미 만들어진 '암호화되지 않은 볼륨'을 '암호화된 볼륨'으로 직접 바꾸는 기능은 없다. 대신 다음의 우회 과정을 거쳐야한다.
  - 암호화 되지 않은 볼륨의 스냅샷을 만든다. -> 해당 스냅샷을 복사하면서 암호화 옵션을 활성화한다. -> 암호화된 새 스냅샷이 생성된다. -> 이 스냅샷을 기반으로 새 볼륨을 생성한다.

## EFS(Elastic File System)

- 여러 EC2 인스턴스가 동시에 접속해서 사용할 수 있는 관리형 네트워크 공유 파일 시스템이다. (NFS)
- EBS가 특정 서버에 꽂는 '외장 하드'라면, EFS는 사무실에서 여러 사람이 공용으로 사용하는 'NAS(Network Attached Storage)'와 유사하다. 클라우드 엔지니어로서 EBS, EFS, S3의 차이를 명확히 아는 것이 SAA 시험의 핵심이다.
- 핵심 특징
  - 공유 저장소: 수천 개의 EC2 인스턴스가 동시에 연결 가능하다. 심지어 서로 다른 가용 영역(AZ)에 있어도 접속할 수 있다.
  - 자동 확장: 용량을 미리 정할 필요가 없다. 데이터를 넣는 만큼 커지고, 지우면 자동으로 줄어든다.
  - 지원 OS: 오직 Linux 기반 인스턴스만 지원한다. (Windows용은 FSx를 사용해야 한다.)
  - 성능 및 비용: EBS보다 비싸지만, 그만큼 관리 효율성과 확장성이 압도적이다.
- 데이터 가용성 전략
  - Standard Storage: 데이터를 여러 AZ에 복제하여 저장한다. 한 AZ가 무너져도 데이터는 안전하다.
  - One Zone Storage: 비용을 아끼기 위해 하나의 AZ에만 저장한다. (개발 환경에 적합, 약 47% 저렴)

### EFS Performance(성능 모드)

- EFS는 워크로드 성격에 따라 두 가지 성능 모드를 선택할 수 있다.
- General Purpose (범용 - 기본값): 지연 시간(Latency)이 가장 짧다. 웹 서버, CMS(WordPress), 홈 디렉토리 등 일반적인 용도에 적합하다.
- Max I/O: 수천 대의 인스턴스가 동시에 접속하여 엄청난 양의 데이터를 쏟아부을 때 사용한다. 지연 시간은 조금 늘어나지만, 전체적인 처리량(Throughput)은 훨씬 높다. (빅데이터 분석, 미디어 인코딩 등)

- 처리량 모드
  - Bursting (기본): 저장된 데이터 양에 비례해서 속도가 결정된다.
  - Provisioned: 저장 용량과 상관없이 내가 필요한 처리량(MiB/s)을 미리 예약한다.
  - Elastic: 사용하는 만큼 성능이 자동으로 조절된다. 예측 불가능한 워크로드에 가장 효율적이다.

### EFS Storage Classes(저장 계층)

- 비용을 아끼기 위해 데이터의 접근 빈도에 따라 저장 장소를 나눌 수 있다.
  - EFS Standard: 자주 사용하는 데이터를 저장하는 기본 계층 / 가장 비쌈
  - EFS Infrequent Access(IA): 최근 30일간 접근하지 않은 데이터를 저장 / 최대 92% 저렴
  - EFS Archive: 1년에 몇번 보지 않는 데이터를 장기 보관 / 최저가
- 수명 주기 관리 (Lifecycle Management)
  - 사용자가 일일이 파일을 옮길 필요 없이, 수명 주기 정책을 설정하면 AWS가 알아서 처리한다.
  - 예시: "생성 후 30일 동안 접근이 없으면 자동으로 IA 계층으로 옮겨줘."
  - 효과: 성능은 유지하면서 비용은 획기적으로 줄일 수 있다.


