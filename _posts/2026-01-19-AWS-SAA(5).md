---
layout: single
title:  "AWS SAA 준비(확장성, 고가용성, ELB, ALB, NLB, GLB)"
categories: [AWS SAA]
tags: [AWS SAA]
toc: true
author_profile: true
---


## 확장성(Scalability)

- 애플리케이션이 부하에 따라 시스템의 자원을 유연하게 조절할 수 있는 능력을 말한다.
- 크게 두가지 방향이 존재한다.
- **수직적 확장(Vertical Scalability / Scale-up)**
  - 정의: 인스턴스의 사양(CPU, RAM)을 더 높은 등급으로 교체하는 것이다. (예: t3.micro → m5.large)
  - 특징: 성능 향상이 확실하지만, 하드웨어의 물리적 한계가 존재하며 교체 시 서비스 중단(Downtime)이 발생할 수 있다.
  - 적합한 사례: 분산 처리가 어려운 데이터베이스 서버 등.
- **수평적 확장 (Horizontal Scalability / Scale-out)**
  - 정의: 동일한 사양의 인스턴스 개수를 늘리는 것이다. (예: 1대 → 3대)
  - 특징: 클라우드 컴퓨팅의 핵심이며, 이론적으로 무한한 확장이 가능하다. 인스턴스를 하나 더 추가하는 방식이므로 서비스 중단 없이 확장이 가능하다.
  - 적합한 사례: 웹 서버, 마이크로서비스(MSA) 등.

## 고가용성 (High Availability, HA)

- 시스템이 하드웨어 장에나 재해 상황에서도 중단 없이 서비스를 지속할 수 있는 능력을 말한다.
- 핵심 키워드: 중복성(Redundancy).
- 구현 방식: 시스템을 최소 두 개 이상의 **가용 영역(Availability Zones, AZ)**에 분산 배치한다.
- 목적: 가용 영역 하나가 화재나 침수로 마비되더라도, 다른 가용 영역에 있는 서버가 즉시 서비스를 이어받아 SPOF(Single Point of Failure, 단일 장애점)를 제거하는 것이다.


## ELB(Elastic Load Balancing)

- 애플리케이션으로 들어오는 네트워크 트레픽을 여러 대의 타겟EC2 인스턴스, 컨테이너, IP 주소 등)으로 자동 분산해주는 관리형 서비스다.
- 왜 사용할까?
  - 부하 분산: 서버 한 대가 감당하기 힘든 트래픽을 여러 대의 서버로 공평하게 나눠준다.
  - 고가용성(HA) 확보: 여러 가용 영역(Multi-AZ)에 걸쳐 트래픽을 분산하므로, 특정 AZ에 장애가 발생해도 서비스가 유지된다
  - 상태 확인(Health Check): 응답이 없는 불량 서버를 자동으로 감지하여 트래픽 전송을 중단하고, 정상적인 서버로만 보낸다.
  - 보안 강화: SSL/TLS 암호화 복호화(SSL Termination)를 로드 밸런서에서 처리하여 서버의 부담을 덜어주고 보안을 중앙 관리한다.
- 핵심 3가지 종류

| 구분 | ALB (Application) | NLB (Network) | GLB (Gateway) |
|------|------------------|---------------|---------------|
| 작동 계층 | Layer 7 (HTTP/HTTPS) | Layer 4 (TCP/UDP/TLS) | Layer 3 (IP) |
| 핵심 특징 | 콘텐츠 기반 라우팅 (경로, 호스트 등) | 초저지연, 정적 IP 제공 | 서드파티 보안 장비 연결 |
| 처리 속도 | 보통 (애플리케이션 분석 필요) | 매우 빠름 (수백만 요청 처리) | 보통 |
| 주요 용도 | 웹 앱, 마이크로서비스(MSA) | 게임, 주식 거래, 고성능 서버 | 방화벽, 침입 탐지 시스템(IDS) |

- 주요 하위 개념
  - 리스너(Listener): 클라이언트의 접속을 대기하는 포트다. (예: HTTP 80번, HTTPS 443번)
  - 타겟 그룹(Target Group): 로드 밸런서가 트래픽을 보낼 대상들의 묶음이다. 여기에 EC2나 컨테이너를 등록한다.
  - 상태 확인(Health Check): 타겟 그룹의 서버들이 살아있는지 주기적으로 확인하는 경로다. (예: /health 경로로 200 OK 응답 확인)


### 보안 그룹 체이닝 (Security Group Chaining)

- 보안을 위해 사용자가 서버(EC2)에 직접 접속하는 것을 막고 반드시 로드 밸런서를 통해서만 접속하게 만든다.
- 보안 그룹 설정
  - 로드 밸런서(ALB)와 애플리케이션 서버(EC2)에 각각 다른 보안 그룹을 적용해야 한다.
  - 로드 밸런서 보안 그룹 (LB-SG)
    - 역할: 대문 역할. 세상 모든 사람의 접속을 허용합니다.
    - 인바운드 규칙: HTTP 80포트, 소스 0.0.0.0/0 (모든 IP허용) / HTTPS 443포트, 소스 0.0.0.0/0
  - 애플리케이션 보안 그룹 (App-SG)
    - 역할: 철저한 내부 보안. 오직 우리 로드 밸런서가 보내는 트래픽만 받는다.
    - HTTP (80번 포트): 소스 LB-SG의 보안 그룹 ID (예: sg-12345abc)
    - **IP 주소 대신 보안 그룹 이름(ID)을 지정함으로써, 로드 밸런서를 거치지 않은 모든 외부 접속을 원천 차단한다.**

### OSI 7계층 순서

- 응용(Application) / HTTP, FTP ... 
- 표현(Presentation)
- 세션(Session)
- 전송(Transport) / TCP, UDP
- 네트워크(Network) / 라우터
- 데이터 링크(Data Link) / 스위치
- 물리(Physical)

## ALB (Application Load Balancer)

- OSI 모델의 Application 계층(7계층)에서 작동한다. 주로 HTTP HTTPS 트래픽의 부하 분산에 최적화 되어있다.
- 특징
  - 콘텐츠 기반 라우팅: 요청의 내용을 분석하여 트래픽을 분산할 수 있습니다.
  - 경로 기반 라우팅: URL 경로(예: /api는 A 그룹으로, /images는 B 그룹으로)에 따라 라우팅한다.
  - 호스트 기반 라우팅: 도메인 이름(예: app.example.com과 blog.example.com)에 따라 라우팅한다.
  - 쿼리 문자열/헤더 기반 라우팅: HTTP 헤더나 쿼리 파라미터 값을 기준으로 라우팅할 수 있다.
- 핵심 구성 요소
  - 리스너(Listener): 클라이언트의 접속을 대기하는 프로세스. 프로토콜(HTTP/HTTPS)과 포트(80, 443 등)를 설정하며, 하나 이상의 규칙을 포함한다.
  - 규칙(Rule): 리스너가 수신한 요청을 어떤 대상 그룹으로 보낼지 결정하는 조건. 우선순위, 조건, 작업(전달, 리다이렉트, 고정 응답 등)으로 구성된다.
  - 대상 그룹(Target Group): 요청을 실제로 처리할 대상들의 집합이다.
    - 대상 유형: EC2 인스턴스, 마이크로서비스(컨테이너), IP 주소, Lambda 함수 등을 등록할 수 있다.
    - 상태 확인(Health Check): 설정된 경로로 주기적인 요청을 보내 대상이 정상인지 확인하고, 장애가 발생한 대상은 자동으로 제외한다.

### Listener Rule 

- 로드 밸런서로 들어온 요청을 어떤 Target Group으로 보낼지 결정하는 규칙이다.
- 경로 기반 라우팅
  - 가장 대표적인 마이크로서비스(MSA) 구조에서 사용되는 방식이다. 하나의 도메인을 사용하면서 뒤에 붙는 경로(/)에 따라 서로 다른 서비스(서버 그룹)로 연결한다.
  - 상황: 쿠팡과 같은 쇼핑몰 서비스를 운영 중이다.
  - 조건: 경로가 /orders/* 이면 $\rightarrow$ 동작: 주문 서비스 대상 그룹으로 전달
  - 조건: 경로가 /images/* 이면 $\rightarrow$ 동작: 이미지 서버(S3 또는 EC2) 대상 그룹으로 전달
  - 효과: 사용자 입장에서는 하나의 사이트처럼 보이지만, 실제로는 기능별로 독립된 서버들이 돌아가게 된다.
- 호스트 기반 라우팅
  - 서로 다른 도메인 이름(Host name)을 하나의 로드 밸런서에서 처리할 때 사용한다.
  - 상황: naver.com이라는 회사에서 블로그 서비스와 메일 서비스를 각각 운영한다.
  - 조건: 호스트가 blog.naver.com 이면 $\rightarrow$ 동작: 블로그 서버 그룹으로 전달
  - 조건: 호스트가 mail.naver.com 이면 $\rightarrow$ 동작: 메일 서버 그룹으로 전달
  - 효과: 여러 개의 도메인을 운영하더라도 로드 밸런서를 각각 만들 필요가 없어 비용이 절감된다.
- HTTP 요청을 HTTPS로 리다이렉트 
  - 보안을 위해 암호화되지 않은 80포트(HTTP) 접속을 자동으로 443포트(HTTPS)로 돌려보내는 설정이다.
  - 상황: 사용자가 주소창에 http://example.com이라고 입력했다.
  - 규칙 설정 (HTTP 80번 리스너)
    - 조건: 모든 요청 (Default) $\rightarrow$ 동작: Redirect to HTTPS://#{host}:443/#{path}?#{query}
    - 효과: 별도의 서버 설정 없이 로드 밸런서 수준에서 강력한 보안 접속을 강제할 수 있다.
- 고정 응답 반환
  - 서버까지 요청을 보내지 않고 로드 밸런서가 직접 응답을 주는 방식이다. 주로 점검 중일 때 사용한다.
  - 상황: 서비스 점검 시간이어서 모든 접속을 차단해야 한다.
  - 조건: 모든 요청 $\rightarrow$ 동작: Fixed Response (상태 코드: 503, 내용: "현재 점검 중입니다.")
  - 효과: 백엔드 서버를 아예 내리거나 복잡한 설정을 바꿀 필요 없이, 로드 밸런서 클릭 한 번으로 공지 페이지를 보여줄 수 있다.
- Listener Rule 구성 요소 

| 구성 요소 | 설명 | 예시 |
|----------|------|------|
| 우선순위 (Priority) | 규칙이 적용되는 순서 (낮을수록 먼저 적용) | 1, 2, 3... |
| 조건 (Condition) | 요청의 어떤 부분을 확인할 것인가? | 경로, 호스트, 헤더, 소스 IP 등 |
| 작업 (Action) | 조건이 맞으면 무엇을 할 것인가? | Forward(전달), Redirect, Fixed Response |



### Listener Port vs Target Group Port

- 두 가지 로드 밸런싱 통신
  - 클라이언트 → 로드 밸런서: 사용자가 로드 밸런서에 접속할 때 쓰는 포트 (리스너 설정)
  - 로드 밸런서 → 대상(EC2): 로드 밸런서가 내부망에서 EC2에게 전달할 때 쓰는 포트 (대상 그룹 설정)
- 실제 트래픽 흐름 예시
  - 사용자가 브라우저에 https://example.com 입력 (접속: 443)
  - ALB 리스너가 443번으로 요청을 받음.
  - ALB가 암호를 풀고(SSL Termination), 대상 그룹 설정을 확인한다.
  - 대상 그룹에 TCP 80 또는 HTTP 80이 적혀 있다면, ALB는 EC2의 80번 포트로 요청을 던진다.
  - EC2 내부의 Nginx나 Apache가 80번에서 대기하다가 요청을 처리한다.

## NLB (Network Load Balancer)

- OSI 모델의 4계층 (Transport)에서 동작하는 로드 밸런서
- TCP, UDP, TLS 프로토콜의 트래픽을 처리하고, **초고성능**과 **고정 IP**가 필요한 환경에서 사용한다.
- 핵심 특징
  - 압도적인 성능: 초당 수백만 개의 요청을 아주 적은 지연 시간(Microseconds 단위)으로 처리할 수 있다. 갑작스러운 트래픽 폭주(Spiking)에도 ALB보다 훨씬 빠르게 대응한다.
  - 고정 IP 제공: 가용 영역(AZ)당 하나의 정적 IP(Static IP)를 할당받을 수 있다. 필요하다면 탄력적 IP(EIP)를 직접 연결할 수도 있다.
  - Source IP 유지: 클라이언트의 IP 주소를 변경하지 않고 백엔드 인스턴스로 그대로 전달한다. (ALB는 X-Forwarded-For 헤더를 사용해야 하지만, NLB는 패킷 레벨에서 이를 보존한다.)
  - UDP 지원: 게임이나 실시간 스트리밍에서 주로 사용하는 UDP 프로토콜을 지원하는 유일한 로드 밸런서다.
- ALB vs NLB 비교

| 구분 | ALB (Application) | NLB (Network) |
|------|------------------|---------------|
| 작동 계층 | 7계층 (HTTP/HTTPS) | 4계층 (TCP/UDP/TLS) |
| IP 주소 | 가변 IP (DNS 이름 사용) | 고정 IP (EIP 가능) |
| 속도/지연 | 보통 (밀리초 단위) | 매우 빠름 (마이크로초 단위) |
| 라우팅 규칙 | 경로, 호스트, 헤더 등 복잡함 | 단순 포트 기반 |
| 상태 확인 | HTTP, HTTPS, gRPC | TCP, HTTP, HTTPS |

- ALB와 마찬가지로 인스턴스의 Inbound rules의 source info에 NLB의 보안 그룹을 지정해주어야 NLB와 Target Group의 EC2 인스턴스와 통신이 가능하다.


## GLB (Gateway Load Balancer)

- OSI 모델의 3계층에서 동작한다.
- 주로 방화벽(Firewall), 침입 탐지 및 방지 시스템(IDS/IPS), 심층 패킷 분석(DPI) 장비와 같은 서드파티 가상 네트워크 어플라이언스를 배포하고 확장하는 데 사용된다. 앞서 정리한 ALB나 NLB가 애플리케이션 트래픽 분산에 집중한다면, GLB는 네트워크 보안 및 검사에 특화되어 있다.
- 작동 원리
  - 트래픽 유입: 외부에서 VPC로 들어오거나, 내부에서 나가는 트래픽이 발생한다.
  - GWLBE(Gateway Load Balancer Endpoint) 경유: 트래픽이 엔드포인트를 통해 GLB로 전달된다.
  - 캡슐화(GENEVE 프로토콜): GLB는 원래의 IP 패킷을 GENEVE(Generic Network Virtualization Encapsulation)라는 프로토콜로 감싼다. (포트 6081 사용)
  - 검사 수행: 감싸진 패킷을 보안 장비(EC2 인스턴스 그룹)로 보낸다. 보안 장비는 패킷을 열어보고 문제가 없으면 다시 GLB로 보낸다.
  - 전달: GLB는 캡슐을 벗기고 원래의 패킷을 목적지로 보낸다.
- 왜 사용할까?
  - 기존에는 여러 대의 방화벽 장비를 운영할 때 가용성을 확보하거나 트래픽을 분산하기가 매우 까다로웠다. GLB는 이 문제를 클라우드 방식으로 해결한다.
  - 수평적 확장성: 보안 장비의 부하가 늘어나면 자동으로 인스턴스 수를 늘려(Auto Scaling) 처리 용량을 확장할 수 있다.
  - 고가용성: 특정 보안 장비에 장애가 발생하면 GLB가 이를 감지하여 정상적인 장비로만 트래픽을 보낸다.
  - 중앙 집중화: 여러 VPC의 트래픽을 하나의 중앙 보안 VPC로 모아서 검사하는 구조를 쉽게 만들 수 있다.
- SAA 포인트
  - GENEVE 프로토콜: GLB가 보안 장비와 통신할 때 사용하는 프로토콜 이름과 포트 번호(6081)를 기억해야 한다.
  - GWLBE (엔드포인트): 트래픽이 발생하는 소스 VPC에 설치되어 GLB와 연결해주는 가상 인터페이스다.
  - Route Table 설정: 트래픽이 목적지로 바로 가지 않고 GWLBE를 거쳐 가도록 라우팅 테이블을 수정해야 한다.

## ALB / NLB / GLB 요약 정리

| 구분 | ALB (Application) | NLB (Network) | GLB (Gateway) |
|------|------------------|---------------|---------------|
| 작동 계층 | 7계층 (HTTP/HTTPS) | 4계층 (TCP/UDP) | 3계층 (IP 패킷) |
| 주요 목적 | 웹 앱 기능 및 경로 라우팅 | 초고성능 및 고정 IP | 보안 및 네트워크 검사 |
| 주요 대상 | EC2, 컨테이너, Lambda | EC2, IP 주소 | 가상 보안 어플라이언스 |
| 특이 사항 | SSL 터미네이션 지원 | 극도로 낮은 지연 시간 | GENEVE 프로토콜 사용 |


