---
layout: single
title:  "AWS SAA 준비(Route 53)"
categories: [AWS SAA]
tags: [AWS SAA]
toc: true
author_profile: true
---


## DNS 동작 방식

![구조](/assets/images/DNSWorks.png)

## Route 53

- 높은 가용성과 확장성을 가진 클라우드 DNS(Domain Name System) 웹 서비스다.
- 이 서비스는 개발자와 기업이 최종 사용자를 EC2 인스턴스, 로드 밸런서, S3 버킷 등 AWS 인프라로 안정적으로 연결할 수 있는 경로를 제공한다.
- 핵심 기능
  - 도메인 등록: example.com과 같은 도메인 이름을 직접 구매하고 관리할 수 있다.
  - DNS 라우팅: www.example.com과 같은 문자 주소를 192.0.2.1과 같은 숫자 IP 주소로 번역하여 브라우저가 서버에 접속하게 한다.
  - 상태 확인 (Health Check): 애플리케이션의 상태를 모니터링한다. 서버에 장애가 발생하면 Route 53은 자동으로 해당 서버로의 트래픽을 차단하고 정상적인 서버로 유도한다.
- Record Types
  - A (Address): 호스트 이름을 IPv4 주소로 연결한다.
  - AAAA: 호스트 이름을 IPv6 주소로 연결한다.
  - CNAME (Canonical Name): 호스트 이름을 다른 호스트 이름으로 연결한다. (예: app.example.com → my-lb.aws.com)
  - Alias (AWS 전용): CNAME과 비슷하지만 AWS 리소스에 특화된 레코드다.
    - 장점: 루트 도메인에 사용할 수 있으며, AWS 리소스의 IP가 바뀌어도 자동으로 추적한다. 또한 별칭 레코드 조회는 비용이 무료다.
- 모든 도메인의 루트에는 해당 도메인의 권한을 증명하는 NS(Name Server) 레코드와 SOA(Start of Authority) 레코드가 반드시 존재해야 한다.
  - 따라서 루트 도메인에 CNAME을 설정하려고 하면 NS, SOA 레코드와 충돌이 발생하기 때문에 DNS 표준상 허용되지 않는다.
  - 루트 도메인과 ALB를 연결하려고 할 때, A Record로 설정해두고, Alias를 사용하여 루트 도메인에도 설정할 수 있다.


## Routing Policy


| 정책 | 설명 | 주요 사례 |
|------|------|-----------|
| 단순 (Simple) | 도메인 하나를 하나의 리소스로 연결한다. | 기본적인 웹사이트 운영 |
| 가중치 (Weighted) | 지정한 비율에 따라 트래픽을 분산한다. (예: 80%는 v1, 20%는 v2) | A/B 테스트, 카나리 배포 |
| 지연 시간 (Latency) | 사용자에게 네트워크 지연 시간이 가장 적은 리전으로 보낸다. | 전 세계 사용자에게 빠른 속도 제공 |
| 장애 조치 (Failover) | 주 서버에 장애가 나면 보조(Backup) 서버로 보낸다. | 재해 복구 (Active-Passive) |
| 지리 위치 (Geolocation) | 사용자가 접속한 국가나 대륙에 따라 라우팅한다. | 언어별 페이지 제공, 법적 규제 준수 |
| 다중값 응답 (Multi-value) | 상태 확인을 통과한 최대 8개의 IP를 클라이언트에 전달한다. | DNS 수준의 간단한 로드 밸런싱 |


| 정책 | 설명 | 주요 사례 |
|------|------|-----------|
| 지리 근접 (Geoproximity) | 사용자와 리소스의 지리적 위치를 기반으로 최단 거리를 계산해 라우팅한다. `Bias(편향)` 값을 설정하여 특정 리전이 커버하는 지리적 범위를 넓히거나 좁힐 수 있다. | 리소스 위치 중심의 트래픽 제어, 특정 리전의 처리 용량에 따른 영역 조정 |
| IP 기반 (IP-based) | 사용자의 **IP 주소 범위(CIDR 블록)**를 기반으로 트래픽을 라우팅한다. 사전에 정의된 IP 리스트와 일치하는 요청을 특정 엔드포인트로 보낸다. | 특정 ISP(인터넷 서비스 제공자) 최적화, 사내 네트워크 사용자 전용 경로 제공, 특정 국가/기업 IP 필터링 및 라우팅 |


## Health Checks

- Route 53은 전 세계에 분산된 상태 확인기(Health Checker)를 통해 지정된 엔드포인트에 요청을 보낸다.
- 성공/실패 판단: 엔드포인트가 지정된 시간 내에 2xx 또는 3xx HTTP 응답 코드를 반환하거나 TCP 연결에 성공하면 '정상(Healthy)'으로 판단한다.
- 임계값(Threshold): 기본적으로 3회 연속 실패하면 '비정상(Unhealthy)', 3회 연속 성공하면 다시 '정상'으로 간주한다. 이 횟수는 설정에서 변경 가능하다.
- 간격(Interval): 기본적으로 30초마다 확인하며, 빠른 확인이 필요한 경우 10초로 설정할 수 있다.
- 상태 확인 3가지 유형
  - 엔드포인트 모니터링 (Monitoring an Endpoint)
    - 가장 일반적인 방식으로, 특정 IP 주소나 도메인 이름을 직접 점검한다.
    - 프로토콜: HTTP, HTTPS, TCP를 지원한다.
    - 문자열 매치: 응답 본문에 특정 단어가 포함되어 있는지 확인하여 애플리케이션의 정상 작동 여부를 더 정밀하게 판단할 수 있다.
  - 계산된 상태 확인 (Calculated Health Checks)
    - 논리 구조: 여러 엔드포인트 중 하나만 살아있어도 정상으로 볼지(OR), 혹은 특정 비율 이상이 살아있어야 정상으로 볼지 등을 설정할 수 있다.
    - 활용: 상위 레벨의 서비스 가용성을 판단할 때 유용하다.
  - CloudWatch 알람 기반 모니터링 (Monitoring CloudWatch Alarms)
    - 직접 접근할 수 없는 리소스(예: 프라이빗 서브넷의 EC2)나 비즈니스 지표를 기준으로 상태를 판단한다.
    - 방식: CloudWatch 알람 상태가 OK이면 정상, ALARM이면 비정상으로 간주한다.
    - 활용: DB CPU 사용률이 너무 높거나, 에러 발생률이 특정 수치를 넘었을 때 트래픽을 차단하도록 설계할 수 있다.
- 보안 그룹 설정: Route 53의 상태 확인기가 서버에 접근할 수 있도록 인바운드 규칙에서 모든 AWS Route 53 IP 범위를 허용해야 한다.


## Resolver Endpoints

![구조](/assets/images/inbound.png)

![구조](/assets/images/outbound.png)


- 가상의 시나리오: 
  - "미래테크"라는 회사는 현재 두 곳에서 서버를 운영하고 있습니다.

- 본사 사무실 (온프레미스): 사내에서만 사용하는 인사 시스템(hr.mirae.local)이 있습니다.
- AWS 클라우드 (VPC): 고객 서비스용 데이터베이스(db.mirae.internal)가 있습니다.

- 이 두 곳은 VPN이나 Direct Connect로 선은 연결되어 있지만, 서로의 "이름(도메인)"은 모르는 상태입니다. 이때 Route 53 리졸버가 해결사로 등장합니다.

- 인바운드 엔드포인트: "사무실에서 AWS DB 찾기"
   - 본사 사무실에 앉아 있는 개발자가 AWS에 있는 데이터베이스에 접속하려고 db.mirae.internal을 입력합니다.

- 문제: 사무실 DNS 서버는 .internal이 뭔지 모릅니다.

- 해결 (Inbound Endpoint):
  - AWS VPC 안에 인바운드 엔드포인트를 만듭니다. (예: IP 10.0.1.50)
  - 사무실 DNS 서버에 설정합니다: "앞으로 *.mirae.internal로 끝나는 주소를 물어보면 AWS에 있는 10.0.1.50으로 가서 물어봐!"
  - 이제 사무실에서도 AWS 내부 도메인을 이름으로 바로 찾을 수 있습니다.

- 아웃바운드 엔드포인트: "AWS 서버에서 사무실 시스템 찾기"
  - AWS에서 돌아가고 있는 애플리케이션 서버가 데이터를 가져오기 위해 본사 사무실의 인사 시스템(hr.mirae.local)에 접속해야 합니다.
- 문제: AWS 리졸버는 사무실에서만 쓰는 .local 주소를 모릅니다.
- 해결 (Outbound Endpoint & Rule):
  - AWS VPC에 아웃바운드 엔드포인트를 만듭니다.
  - 전달 규칙(Forwarding Rule)을 만듭니다: "만약 누군가 *.mirae.local을 찾으면, 본사 사무실 DNS 서버(192.168.1.10)에게 물어봐!"
  - 이제 AWS 서버가 아웃바운드 엔드포인트를 통해 사무실 DNS에 물어보고 IP를 알아내서 접속할 수 있습니다.