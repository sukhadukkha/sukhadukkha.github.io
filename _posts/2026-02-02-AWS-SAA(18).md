---
layout: single
title:  "AWS SAA 준비(WAF, Shield, Firewall Manager, GuardDuty, Inspector, Macie)"
categories: [AWS SAA]
tags: [AWS SAA]
toc: true
author_profile: true
---


## AWS WAF (Web Application Firewall)

### 개요
- 웹 애플리케이션을 보호하는 관리형 방화벽 서비스
- HTTP/HTTPS 요청을 검사하는 L7 보안 서비스
- 애플리케이션 앞단에서 공격 트래픽을 필터링

---

### 보호 대상 (시험 중요)
- CloudFront
- Application Load Balancer (ALB)
- API Gateway

* EC2, Network Load Balancer에는 직접 적용 불가

---

### 방어 가능한 공격 유형
- SQL Injection
- Cross-Site Scripting (XSS)
- 악성 Bot 트래픽
- 특정 IP 차단
- 국가(Region) 기반 차단
- 비정상 요청 패턴

---

### 주요 구성 요소

- Web ACL
    - WAF의 최상위 정책 단위
    - 허용(Allow), 차단(Block), Count 동작 설정

- Rule
    - 요청을 검사하는 조건
    - IP, URI, Header, Query String 기반

- Rule Group
    - 여러 Rule을 묶은 집합
    - AWS Managed Rule Group 사용 가능

---

### Rule 유형

- IP 기반 Rule
- Geo Match Rule (국가별 차단)
- Rate-based Rule
    - 일정 시간 내 요청 수 초과 시 차단

---

### 동작 흐름

- Client Request

- AWS WAF (L7 요청 검사)

- CloudFront / ALB / API Gateway

- Backend Service


---

### AWS Managed Rules
- AWS가 관리하는 사전 정의 Rule 세트
- OWASP Top 10 대응
- 운영 부담 감소

---

### WAF vs 다른 보안 서비스 (시험 단골)

- WAF
    - L7
    - HTTP/HTTPS 요청 내용 검사
    - SQLi, XSS 차단

- Security Group
    - L4
    - 포트, 프로토콜, IP 기준
    - Stateful

- NACL
    - L3/L4
    - 서브넷 단위
    - Stateless

---

### WAF vs Shield
- WAF
    - 애플리케이션 계층 공격 방어
- Shield
    - DDoS 공격 방어
    - Shield Standard는 자동 활성화

---

### 로깅 및 모니터링
- CloudWatch Metrics 제공
- S3에 WAF 로그 저장 가능
- Athena로 로그 분석 가능

---

### 시험 포인트 정리
- SQL Injection, XSS 방어 → WAF
- 국가별 접근 차단 → WAF (Geo Match)
- DDoS + 애플리케이션 공격 방어 → Shield + WAF

---

### 한 줄 요약
- HTTP 요청 내용을 보고 차단해야 하면 AWS WAF


---


## AWS Shield

### 개요
- AWS에서 제공하는 관리형 DDoS 보호 서비스
- 네트워크 및 전송 계층 공격을 자동으로 방어
- 별도 설정 없이 기본 보호 제공 (Shield Standard)

---

### 보호 대상
- CloudFront
- Route 53
- Application Load Balancer (ALB)
- Network Load Balancer (NLB)
- Elastic IP (EC2)

---

### 공격 유형
- SYN Flood
- UDP Reflection
- DNS Amplification
- 대규모 트래픽 기반 DDoS 공격

---

### Shield Standard

- 모든 AWS 고객에게 자동 활성화
- 추가 비용 없음
- 일반적인 DDoS 공격 방어

---

### Shield Advanced

- 유료 서비스
- 대규모, 정교한 DDoS 공격 방어
- 실시간 공격 탐지 및 완화

---

### Shield Advanced 주요 기능

- DDoS Response Team (DRT) 지원
- WAF와 통합 가능
- 비용 보호
    - DDoS로 인한 스케일링 비용 보상

---

### Shield vs WAF (시험 단골 비교)

- Shield
    - L3 / L4
    - 트래픽 폭주 기반 공격 방어
    - 자동 보호

- WAF
    - L7
    - HTTP/HTTPS 요청 내용 검사
    - SQL Injection, XSS 방어

---

### 시험 포인트

- 대규모 트래픽 공격
    - Shield

- 애플리케이션 공격 + DDoS
    - Shield + WAF

- 별도 설정 없이 기본 DDoS 보호
    - Shield Standard

---

### 한 줄 요약
- 대규모 트래픽 기반 DDoS 공격 방어는 AWS Shield


---


## AWS Firewall Manager

### 개요
- 여러 AWS 계정과 리소스에 보안 정책을 **중앙에서 관리**하는 서비스
- AWS Organizations 기반으로 동작
- 대규모 멀티 계정 환경에서 보안 정책 일관성 유지 목적

---

### 관리 대상 서비스
- AWS WAF
- AWS Shield Advanced
- VPC Security Group
- AWS Network Firewall
- Route 53 Resolver DNS Firewall

---

### 핵심 기능

- 중앙 정책 관리
    - 한 번의 정책 정의로 모든 계정에 적용
    - 신규 계정에도 자동 적용

- 정책 강제 적용
    - 사용자가 임의로 보안 설정 변경 불가
    - 규정 준수(Compliance) 목적에 적합

---

### 동작 조건

- AWS Organizations 필수
- 관리 계정(Management Account)에서 설정
- 멤버 계정에 자동 전파

---

### 사용 사례

- 여러 계정에서 동일한 WAF 규칙 적용
- 전사 공통 DDoS 방어 정책 적용
- 보안팀이 모든 계정의 방화벽 정책 통제

---

### 시험 포인트

- “모든 계정에 일괄 적용”
    - Firewall Manager

- “중앙에서 보안 정책 관리”
    - Firewall Manager

- “멀티 계정 환경 보안 관리”
    - Firewall Manager

---

## WAF, Shield, Firewall Manager 비교

### 역할 관점 비교

| 서비스 | 주요 역할 | 계층 |
|------|----------|------|
| WAF | 웹 요청 내용 기반 공격 차단 | L7 |
| Shield | 대규모 DDoS 공격 방어 | L3/L4 |
| Firewall Manager | 보안 정책 중앙 관리 | 관리 계층 |

---

### 기능 비교

| 항목 | WAF | Shield | Firewall Manager |
|----|----|----|----|
| SQL Injection / XSS | 가능 | 불가 | 직접 수행 안 함 |
| DDoS 방어 | 부분적 | 가능 | Shield 정책 관리 |
| 중앙 정책 관리 | 불가 | 불가 | 가능 |
| 멀티 계정 지원 | 제한적 | 제한적 | 필수 기능 |
| 자동 보호 | 규칙 기반 | 자동 | 정책 강제 |

---

### 언제 무엇을 쓰는가 (시험 정리)

- 웹 요청 내용을 보고 차단해야 한다
    - WAF

- 대규모 트래픽 기반 공격을 막아야 한다
    - Shield

- 여러 계정에 동일한 보안 정책을 강제로 적용해야 한다
    - Firewall Manager

---

### 한 줄 요약

- WAF: 웹 공격 필터
- Shield: DDoS 방패
- Firewall Manager: 보안 정책 총괄 관리자


---

## DDoS Protection 구조


![구조](/assets/images/DDoSProtection.png)

이 아키텍처는 **계층별 방어(Defense in Depth)** 전략을 통해  
인프라의 **가용성을 확보**하고 **악성 공격을 사전에 차단**하는 것을 목표로 한다.

---

## 1. 전역 엣지 서비스 계층 (Edge Services)

사용자의 요청이 **AWS 리전에 도달하기 전**, 최전방에서 트래픽을 필터링하는 계층이다.

### BP1. Amazon CloudFront & Global Accelerator
- 전 세계 엣지 로케이션을 활용해 트래픽 분산
- 공격 지점(Attack Surface) 최소화
- 대규모 트래픽 흡수 및 완화

### BP2. AWS WAF
- HTTP/HTTPS 요청 검사 (L7)
- SQL Injection, XSS 등 악성 페이로드 차단
- Rate-based Rule을 통한 HTTP Flood 대응

### BP3. Amazon Route 53
- 전역 가용성이 보장된 DNS 서비스
- DNS Query Flood 공격 방어
- AWS Shield Standard와 자동 연계

---

## 2. 네트워크 및 리전 보호 계층 (Region & VPC)

실제 애플리케이션 리소스가 위치한 **리전 내부 보안 계층**이다.

### BP5. VPC (Virtual Private Cloud)
- 논리적으로 격리된 네트워크 구성
- 퍼블릭 / 프라이빗 서브넷 분리
- 백엔드 리소스 직접 접근 차단

### BP6. Elastic Load Balancing (ELB)
- 트래픽을 다수의 대상(EC2 등)으로 분산
- 비정상 연결 시도에 대한 1차 관문 역할
- ALB는 WAF 연동 가능

### BP2 & BP4. AWS WAF & API Gateway
- 엣지뿐 아니라 리전 진입 지점에서도 WAF 적용
- ALB, API Gateway에 WAF 연결
- 이중 방어(Defense in Depth) 구현

---

## 3. 서비스 회복 탄력성 계층 (Resiliency)

공격이 발생하더라도 **서비스가 중단되지 않도록 버티는 능력**을 확보하는 계층이다.

### BP7. Auto Scaling Group
- 트래픽 급증 시 인스턴스 자동 확장 (Scale-out)
- 대규모 요청에도 서비스 가용성 유지

### BP8. AWS Region (Multi-AZ)
- 다중 가용 영역(Multi-AZ) 설계
- 특정 AZ 장애 발생 시에도 서비스 연속성 보장

---

## 핵심 비교 포인트 (SAA 시험 대비)

| 공격 유형 | 방어 서비스 | 계층 |
|----------|------------|------|
| 인프라 계층 DDoS (UDP Flood 등) | AWS Shield, Route 53, CloudFront | L3 / L4 |
| 애플리케이션 계층 DDoS (HTTP Flood 등) | AWS WAF, ALB (Rate-based Rule) | L7 |
| 대규모 트래픽 폭주 | Auto Scaling, CloudFront | 인프라 전반 |

---

## 한 줄 요약
- **엣지에서 최대한 막고**
- **리전 진입 지점에서 한 번 더 걸러내며**
- **Auto Scaling과 Multi-AZ로 끝까지 버틴다**


---

## AWS GuardDuty

### 개요
- AWS에서 제공하는 **지능형 위협 탐지 서비스**
- 머신러닝(ML), 이상 탐지, 위협 인텔리전스를 활용
- 계정, 워크로드, 데이터에 대한 **의심스러운 활동을 탐지**하는 데 목적

---

### 탐지 대상 데이터 소스 (시험 중요)

- CloudTrail 이벤트
    - 관리 이벤트 (Control Plane)
    - 데이터 이벤트 (S3)
- VPC Flow Logs
- DNS Logs
- EKS Audit Logs

---

### 탐지 가능한 위협 유형

- 비정상적인 API 호출
- 탈취된 자격 증명 사용
- 해외 IP에서의 의심스러운 접근
- EC2 인스턴스의 악성 행위
- 암호화폐 채굴 시도
- S3 퍼블릭 접근 이상 징후

---

### 주요 특징

- 에이전트 설치 불필요
- 계정 단위로 활성화 가능
- 실시간 위협 탐지 및 알림 제공
- 기존 로그를 분석하여 자동 탐지

---

### 결과(Findings)

- GuardDuty는 **탐지만 수행**
- 차단 또는 대응은 수행하지 않음
- Findings는 CloudWatch Events(EventBridge)로 전달 가능

---

### 자동 대응 연계

- EventBridge + Lambda
- 의심스러운 리소스 격리
- 보안 그룹 수정
- IAM 사용자 비활성화

---

### 멀티 계정 지원

- Master / Member 구조
- 중앙 계정에서 모든 계정의 위협 모니터링
- AWS Organizations와 연동 가능

---

### GuardDuty vs 다른 보안 서비스 (시험 구분)

- GuardDuty
    - 위협 탐지
    - 사후 감지(Detect)

- WAF
    - 공격 차단
    - 사전 방어(Prevent)

- Shield
    - DDoS 방어
    - 트래픽 기반 보호

---

### 시험 포인트

- “의심스러운 활동을 탐지”
    - GuardDuty

- “에이전트 설치 없이”
    - GuardDuty

- “자동 대응은 별도 구성”
    - GuardDuty + Lambda

---

### 한 줄 요약
- **GuardDuty는 막지 않고 ‘발견’만 한다**

---

## AWS Inspector

### 개요
- AWS 리소스의 **보안 취약점을 자동으로 평가**하는 서비스
- EC2 인스턴스와 컨테이너 이미지의 **취약점(CVE) 탐지**에 집중
- 지속적인 보안 상태 점검 목적

---

### 평가 대상 (시험 중요)

- EC2 인스턴스
    - OS 패키지 취약점
    - 네트워크 노출 구성

- 컨테이너 이미지
    - Amazon ECR에 저장된 이미지
    - 이미지 내 라이브러리 취약점

- Lambda 함수
    - 사용 중인 라이브러리 취약점

---

### 주요 특징

- 지속적(Continuous) 스캔
- CVE 데이터베이스 기반 취약점 분석
- 자동 활성화 가능
- 에이전트 불필요 (EC2는 SSM Agent 사용)

---

### 결과 (Findings)

- 취약점 심각도 제공 (Critical / High / Medium / Low)
- 권장 조치 사항 제시
- 보안 구성 미흡 항목 식별

---

### GuardDuty와 차이 (시험 단골)

- Inspector
    - 취약점 점검 (정적 상태)
    - “문이 열려 있는지” 확인

- GuardDuty
    - 위협 탐지 (동적 행위)
    - “도둑이 들어오는지” 감지

---

### 자동 대응 연계

- EventBridge 연동 가능
- Lambda로 패치 자동화
- SSM Patch Manager와 연계

---

### 시험 포인트

- “취약점 스캔”
    - Inspector

- “CVE 기반 점검”
    - Inspector

- “지속적인 보안 평가”
    - Inspector

---

### 한 줄 요약
- **Inspector는 취약한지 점검하고, GuardDuty는 수상한 행동을 감시한다**

---

## AWS Macie

### 개요
- S3에 저장된 데이터를 자동으로 분석하여 **민감 정보 탐지**를 수행하는 서비스
- 머신러닝을 사용해 데이터 유형을 식별
- 개인정보 및 규제 데이터 보호 목적

---

### 주요 탐지 대상
- 개인정보(PII)
    - 주민등록번호
    - 이메일 주소
    - 전화번호
- 금융 정보
    - 신용카드 번호
- 기타 민감 데이터

---

### 핵심 기능
- S3 객체 자동 스캔
- 민감 데이터 위치 식별
- 퍼블릭 버킷 또는 잘못된 권한 탐지
- 위험 수준 알림 제공

---

### 특징
- S3 전용 서비스
- 에이전트 설치 불필요
- 계정 단위 또는 멀티 계정 관리 가능

---

### 시험 포인트
- “S3에 저장된 민감 데이터 탐지”
    - Macie

- “개인정보 포함 여부 확인”
    - Macie

---

### 한 줄 요약
- **S3 안에 민감 정보가 있는지 찾아주는 서비스**

