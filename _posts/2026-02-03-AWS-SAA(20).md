---
layout: single
title:  "AWS SAA 준비(VPC Peering, VPC Endpoint, VPC Flow Logs, Site-to-Site VPN, Direct Connection(DX) )"
categories: [AWS SAA]
tags: [AWS SAA]
toc: true
author_profile: true
---


## AWS VPC Peering

---

## 1. VPC Peering 개요

- 두 개의 VPC를 **프라이빗 네트워크로 직접 연결**하는 기능
- AWS 백본 네트워크를 사용
- 인터넷, NAT, VPN 없이 통신 가능

---

## 2. 핵심 특징

- Private IP로 통신
- 낮은 지연, 높은 대역폭
- VPC 간 **1:1 연결**
- 트래픽 암호화 (AWS 내부)

---

## 3. 필수 조건 (시험 중요)

- **VPC CIDR가 서로 겹치면 안 됨**
- 같은 리전 또는 다른 리전 가능
- 다른 AWS 계정 간도 가능

---

## 4. 동작 방식

### 기본 흐름

VPC A (10.0.0.0/16)<br>
↔ VPC Peering<br>
VPC B (10.1.0.0/16)<br>


- 각 VPC의 Route Table에
    - 상대 VPC CIDR 경로 추가 필요

---

## 5. 라우팅 설정 (중요)

### VPC A 라우트 테이블
Destination: 10.1.0.0/16<br>
Target: pcx-xxxx<br>


### VPC B 라우트 테이블
Destination: 10.0.0.0/16<br>
Target: pcx-xxxx<br>


👉 **양쪽 모두 설정 필요**

---

## 6. 보안 설정

- Security Group
    - 상대 VPC CIDR 허용 필요
- NACL
    - 양방향 트래픽 허용 필요

---

## 7. 제한 사항 (시험 단골)

### Transitive Peering ❌

VPC A ↔ VPC B ↔ VPC C<br>
A ↔ C 통신 불가<br>


- 반드시 직접 Peering 필요

---

### Edge-to-Edge Routing ❌

- IGW, VPN, DX 트래픽 전달 불가
- VPC 간 순수 프라이빗 통신만 가능

---

## 8. VPC Peering vs 다른 연결 방식

| 항목 | VPC Peering | Transit Gateway |
|------|-------------|-----------------|
| 연결 구조 | 1:1 | Hub-and-Spoke |
| 확장성 | 낮음 | 높음 |
| 관리 | 복잡 | 단순 |
| 트랜지티브 | ❌ | ⭕ |

---

## 9. 시험 시나리오 예시

- 서로 다른 VPC의 EC2가
    - Private IP로 통신
    - 인터넷 사용 ❌
    - 비용 최소화

→ **VPC Peering**

---

## 10. 한 줄 요약

- **VPC Peering = 두 VPC를 직접 프라이빗 연결**
- CIDR 겹치면 불가
- 트랜지티브 라우팅 불가


---

## AWS VPC Endpoints

---

## 1. VPC Endpoints 개요

- VPC 내부에서 **AWS 서비스에 프라이빗하게 접근**하는 기능
- 인터넷, NAT Gateway, VPN 없이 통신
- AWS 백본 네트워크 사용

---

## 2. 왜 필요한가?

### 문제 상황
- 프라이빗 서브넷 EC2가
    - S3
    - DynamoDB
    - SSM 등에 접근해야 함

### 일반 해결
- NAT Gateway → 비용 발생

### VPC Endpoint 사용
- NAT, IGW 없이 프라이빗 접근
- 보안 + 비용 절감

---

## 3. VPC Endpoint 종류

### 3.1 Gateway Endpoint

- 라우트 테이블 기반
- 대상 서비스 한정

#### 지원 서비스
- S3
- DynamoDB

#### 특징
- 무료
- 라우트 테이블에 자동 경로 추가

---

### 3.2 Interface Endpoint (PrivateLink)

- ENI 기반
- 대부분의 AWS 서비스 지원

#### 예시 서비스
- EC2 API
- SSM
- KMS
- Secrets Manager
- CloudWatch

#### 특징
- 비용 발생
- Security Group 적용 가능

---

## 4. 동작 방식 비교

### Gateway Endpoint

Private EC2<br>
→ Route Table<br>
→ S3 / DynamoDB<br>


### Interface Endpoint

Private EC2<br>
→ ENI (Interface Endpoint)<br>
→ AWS Service<br>


---

## 5. 보안 설정

- Gateway Endpoint
    - Route Table 기반
    - Endpoint Policy 적용 가능

- Interface Endpoint
    - Security Group 적용
    - NACL 영향 있음

---

## 6. 시험 단골 비교

| 요구사항 | 정답 |
|--------|------|
| S3/DynamoDB 프라이빗 접근 | Gateway Endpoint |
| 대부분 AWS 서비스 접근 | Interface Endpoint |
| NAT 비용 제거 | VPC Endpoint |
| 온프레미스에서 접근 | VPN / DX |

---

## 7. VPC Endpoint vs VPC Peering

| 항목 | VPC Endpoint | VPC Peering |
|------|--------------|-------------|
| 연결 대상 | AWS 서비스 | 다른 VPC |
| 인터넷 사용 | ❌ | ❌ |
| CIDR 겹침 | 상관없음 | ❌ |
| 확장성 | 높음 | 낮음 |

---

## 8. 시험 시나리오 예시

- 프라이빗 서브넷 EC2가
    - S3에 접근해야 함
    - 인터넷/NAT 사용 금지

→ **S3 Gateway Endpoint**

---

## 9. 한 줄 요약

- **VPC Endpoint = AWS 서비스로 가는 전용 프라이빗 통로**
- S3/DynamoDB → Gateway
- 나머지 → Interface

![구조](/assets/images/VPCEndpoint.png)
![구조](/assets/images/VPCEndpointsType.png)


---


## AWS VPC Flow Logs

---

## 1. VPC Flow Logs 개요

- VPC 내 네트워크 트래픽 정보를 **로그로 기록**
- 인바운드 / 아웃바운드 트래픽 모두 기록 가능
- 허용(ACCEPT) / 거부(REJECT) 여부 확인 가능

---

## 2. 기록 대상

Flow Logs는 **3가지 레벨**에서 생성 가능

- VPC 전체
- Subnet
- Network Interface (ENI)

---

## 3. 어떤 정보를 기록하나

- Source IP / Destination IP
- Source Port / Destination Port
- Protocol (TCP/UDP)
- Packet / Byte 수
- Action (ACCEPT / REJECT)
- Log time

👉 **패킷 내용(payload)은 기록 ❌**

---

## 4. 로그 저장 위치

- CloudWatch Logs
- Amazon S3(Athena 사용 가능)
- Kinesis Data Firehose

---

## 5. 무엇을 알 수 있나

### 가능한 것
- 보안 그룹 / NACL 차단 여부 확인
- 포트 미허용 문제 분석
- 의심 트래픽 패턴 분석

### 불가능한 것
- HTTP 내용
- SQL / API Payload
- 애플리케이션 레벨 분석

---

## 6. Flow Logs로 알 수 있는 것 / 없는 것 (시험 중요)

| 질문 | Flow Logs |
|----|-----------|
| 트래픽이 허용됐나? | ⭕ |
| 어디서 어디로 갔나? | ⭕ |
| 왜 거부됐나 (SG/NACL)? | ⭕ |
| HTTP 500 에러 원인 | ❌ |
| SQL Injection 여부 | ❌ |

---

## 7. 보안 그룹 vs NACL 분석 예시

### 상황
- EC2 웹 서버 접속 불가

### Flow Log 확인

REJECT 203.0.113.10:443 → 10.0.1.10:80<br>


👉 NACL 또는 SG에서 인바운드 차단<br>

---

## 8. 시험 시나리오 예시

- EC2 간 통신 불가
- 보안 설정은 정상처럼 보임
- **네트워크 레벨 원인 파악 필요**

→ **VPC Flow Logs**

---

## 9. Flow Logs 주의사항 (시험)

- 트래픽이 있어야 로그 생성
- 실시간 아님 (약간의 지연)
- 일부 트래픽은 기록 안 됨
    - DNS
    - DHCP
    - Instance metadata

---

## 10. 한 줄 요약

- **VPC Flow Logs = 네트워크 트래픽 블랙박스**
- 허용/차단 여부 확인용
- 패킷 내용은 절대 안 나옴


---

# AWS Site-to-Site VPN

---

## 1. Site-to-Site VPN 개요

- **온프레미스 네트워크 ↔ AWS VPC**를 연결
- 공용 인터넷을 사용하지만 **IPsec으로 암호화**
- 하이브리드 아키텍처의 기본 구성

---

## 2. 구성 요소

### 2.1 Virtual Private Gateway (VGW)

- AWS 측 VPN 종단점
- VPC에 연결(Attach)됨
- AWS에서 관리

---

### 2.2 Customer Gateway (CGW)

- 고객(온프레미스) 측 VPN 장비
- 물리 방화벽 or 소프트웨어 VPN 장비
- 고객이 관리

---

### 2.3 VPN Connection

- VGW ↔ CGW 사이의 암호화된 터널
- 기본적으로 **2개의 터널** 제공 (고가용성)

---

## 3. 아키텍처 흐름

On-Prem Network<br>
|<br>
[ Customer Gateway ]<br>
|<br>
==== IPsec Tunnel ====<br>
|<br>
[ Virtual Private Gateway ]<br>
|<br>
VPC<br>


---

## 4. 라우팅 방식 (시험 중요)

### Static Routing
- 라우트 직접 등록
- 단순하지만 확장성 낮음

### Dynamic Routing (BGP)
- 권장 방식
- 네트워크 변경 자동 반영

---

## 5. 필수 설정 단계 요약

1. Customer Gateway 생성
  - 온프레미스 공인 IP 필요

2. Virtual Private Gateway 생성
  - VPC에 Attach

3. Site-to-Site VPN 생성
  - CGW + VGW 연결

4. Route Table 설정
  - 온프레미스 CIDR → VGW

---

## 6. 성능 및 특성

- 인터넷 기반 → 지연 가능
- 대역폭 제한 있음
- 테스트/임시/백업용으로 적합

---

## 7. 시험 시나리오 예시

- 온프레미스 서버가
  - VPC EC2와 통신
  - 암호화 필요
  - 빠른 구축

→ **Site-to-Site VPN**

---

## 8. VPN vs Direct Connect

| 항목 | Site-to-Site VPN | Direct Connect |
|------|------------------|----------------|
| 연결망 | 인터넷 | 전용선 |
| 암호화 | ⭕ | ❌ (별도 필요) |
| 지연 | 가변적 | 안정적 |
| 구축 속도 | 빠름 | 느림 |

---

## 9. 시험 포인트 한 줄 요약

- **VGW = AWS 측 VPN 장비**
- **CGW = 고객 측 VPN 장비**
- Site-to-Site VPN은 기본 2개 터널 제공

---


# AWS Direct Connect (DX)

---

## 1. AWS Direct Connect 개요

- 온프레미스 ↔ AWS 간 **전용 네트워크 회선**
- 인터넷을 거치지 않음
- 안정적인 지연, 높은 대역폭 제공

---

## 2. 왜 Direct Connect를 쓰나?

- 대용량 데이터 전송
- 지연(latency) 최소화
- 네트워크 품질 안정성 필요

---

## 3. 기본 아키텍처

On-Prem Data Center<br>
|<br>
[ Direct Connect Location ]<br>
|<br>
==== Dedicated Line ====<br>
|<br>
[ AWS Network ]<br>
|<br>
VPC<br>


---

## 4. 구성 요소

### 4.1 Direct Connect Location

- AWS와 고객 네트워크가 만나는 물리적 위치
- 고객 또는 파트너 시설

---

### 4.2 Virtual Interface (VIF)

- DX 연결 위에서 생성
- 트래픽 유형에 따라 분리

#### Public VIF
- S3, DynamoDB 등 퍼블릭 AWS 서비스 접근

#### Private VIF
- VPC 프라이빗 IP 접근

---

### 4.3 Virtual Private Gateway / Transit Gateway

- Private VIF 종단점
- 연결 대상 VPC

---

## 5. 보안 특성 (시험 중요)

- 인터넷 사용 ❌
- 기본적으로 **암호화 ❌**
- 필요 시 VPN over DX 구성 가능

---

## 6. Direct Connect vs Site-to-Site VPN

| 항목 | Direct Connect | Site-to-Site VPN |
|------|----------------|------------------|
| 연결망 | 전용선 | 인터넷 |
| 암호화 | ❌ | ⭕ |
| 지연 | 안정적 | 가변적 |
| 비용 | 높음 | 낮음 |
| 구축 | 느림 | 빠름 |

---

## 7. 고가용성 설계 (시험 단골)

- DX 장애 대비
  - Site-to-Site VPN을 **백업**으로 구성
- 또는
  - 다중 DX Location 사용

---

## 8. 시험 시나리오 예시

- 금융/미디어 기업
- 대용량 데이터
- 일정한 네트워크 품질 필수

→ **Direct Connect**

---

## 9. 한 줄 요약 (시험용)

- **Direct Connect = 전용선, 안정성**
- 암호화 필요하면 VPN과 함께 사용