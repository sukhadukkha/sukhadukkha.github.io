---
layout: single
title:  "AWS SAA 준비(Transit Gateway, VPC Traffic Mirroring, Egress Gateway, Network Firewall)"
categories: [AWS SAA]
tags: [AWS SAA]
toc: true
author_profile: true
---


## AWS Transit Gateway

---

## 1. Transit Gateway 개요

- 수천 개의 VPC와 온프레미스 네트워크를 **중앙에서 연결하는 네트워크 허브 서비스**
- 복잡한 **Mesh 형태의 VPC Peering 구조를 단순화**
- **AWS 백본 네트워크**를 사용하여 고성능·저지연 통신 제공

---

## 2. 핵심 특징

- **Hub-and-Spoke 아키텍처** 구현
- **트랜지티브 라우팅(Transitive Routing) ⭕**
    - VPC A ↔ TGW ↔ VPC B 구조에서
    - A와 B는 직접 피어링 없이 통신 가능
- **Inter-Region 피어링 지원**
    - 여러 리전에 걸친 글로벌 네트워크 통합 가능
- **중앙 집중식 관리**
    - 보안 정책 및 네트워크 제어를 한 곳에서 관리

---

## 3. 주요 구성 요소

- **Attachments**
    - VPC, Site-to-Site VPN, Direct Connect 등을 TGW에 연결하는 지점

- **Transit Gateway Route Table**
    - 트래픽의 다음 목적지를 결정하는 중앙 라우트 테이블

- **Associations**
    - 특정 Attachment가 어떤 TGW Route Table을 사용할지 결정

- **Propagations**
    - Attachment의 라우팅 정보를 TGW Route Table에 자동 전파

---

## 4. 동작 방식

### 기본 흐름

VPC A / VPC B / On-Prem<br>
↓ (Attachments)<br>
Transit Gateway<br>
↓ (Route Tables)<br>
목적지로 트래픽 전달<br>


- 각 VPC의 Route Table에서
    - 외부 트래픽(0.0.0.0/0 또는 특정 CIDR)의 Target을 `tgw-xxxx`로 설정

---

## 5. VPC Peering vs Transit Gateway 비교

| 항목 | VPC Peering | Transit Gateway |
|------|------------|----------------|
| 연결 모델 | 1:1 직접 연결 (Mesh) | 중앙 허브 (Hub-and-Spoke) |
| 트랜지티브 라우팅 | ❌ 불가 | ⭕ 가능 |
| 관리 복잡성 | 연결 수 증가 시 급증 | 중앙에서 일괄 관리 |
| 비용 | 데이터 전송 비용만 | 시간당 요금 + 데이터 처리 비용 |
| 확장성 | 낮음 (VPC당 최대 125개) | 높음 (수천 개 연결 가능) |

---

## 6. 제한 사항 및 고려 사항

- **비용**
    - VPC Peering보다 비쌈
    - 데이터 전송 비용 외에 **TGW 데이터 처리 비용(GB당)** 발생

- **설계 복잡도**
    - Route Table 분리, Association / Propagation 설계 필요

- **IP 대역**
    - 연결되는 네트워크 간 **CIDR 중복 불가**

---

## 7. 시험 포인트 정리 (SAA / SAP 단골)

- 수백 개 이상의 VPC를 연결해야 한다 → **Transit Gateway**
- 온프레미스(VPN/DX)와 여러 VPC를 동시에 연결 → **Transit Gateway**
- 가장 저렴한 1:1 연결 방식 → **VPC Peering**
- 중앙 집중식 보안 검사(Inspection VPC) 구현 → **Transit Gateway**

---

## 8. 한 줄 요약

- **Transit Gateway는 모든 네트워크를 한곳으로 모으는 중앙 통제소**
- **대규모 멀티 VPC 환경에서 트랜지티브 라우팅의 핵심**


---

## VPC Traffic Mirroring

- EC2 인스턴스의 **네트워크 트래픽을 복제(Mirror)** 하여
    - 보안 분석
    - 침입 탐지
    - 네트워크 모니터링 용도로 사용하는 기능

- **실제 트래픽 흐름에는 영향 없음**
    - 복사본만 분석 시스템으로 전달

---

### 주요 특징

- **ENI(Elastic Network Interface) 단위**로 트래픽 미러링
- 인바운드 / 아웃바운드 트래픽 선택 가능
- **필터(Filter)** 로 특정 프로토콜/포트만 미러링 가능
- 미러링 대상(Target)
    - NLB
    - ENI (IDS/IPS, 분석 서버)

---

### 기본 흐름

EC2 (ENI)<br>
→ Traffic Mirroring<br>
→ 분석 시스템 (IDS / 보안 어플라이언스)<br>


---

### 언제 사용하나? (시험 포인트)

- 패킷 내용까지 분석해야 할 때
- VPC Flow Logs로는 부족한 경우
- 보안 감사 / 침입 탐지 시스템 연동

---

### Flow Logs vs Traffic Mirroring

| 항목 | VPC Flow Logs | Traffic Mirroring |
|------|---------------|-------------------|
| 패킷 메타데이터 | ⭕ | ⭕ |
| 패킷 내용 | ❌ | ⭕ |
| 실시간 분석 | ❌ | ⭕ |
| 성능 영향 | 없음 | 매우 낮음 |

---

### 한 줄 요약

- **VPC Traffic Mirroring = 패킷 복사해서 실시간 분석**


---

## 만약 Subnet 안의 IPv4가 부족해지면?
- 서브넷에서 EC2 인스턴스를 실행할 수 없는 이유는 가용 IPv4 주소가 없기 때문이며, 이를 해결하기 위해 VPC에 새로운 IPv4 CIDR을 생성(추가)해야 한다.
- VPC 안에 보조 CIDR 추가
- 새 서브넷 생성
- 리소스 배치

---

## Egress-Only Internet Gateway

- **IPv6 전용 아웃바운드 전용 인터넷 게이트웨이**
- VPC의 **IPv6 인스턴스가 외부 인터넷으로 나가는 것만 허용**
- 외부에서 **VPC로의 인바운드 연결은 차단**

---

### 왜 필요한가?

- IPv6에는 NAT 개념이 없음
- IPv6 주소는 기본적으로 글로벌 유니캐스트

→ **외부에서 직접 접근되는 문제 방지**

---

### 동작 방식

IPv6 EC2<br>
→ Egress-Only IGW<br>
→ Internet<br>


- 라우트 테이블에서
    - `::/0` → Egress-Only Internet Gateway

---

### 특징 요약

- 인바운드 ❌ / 아웃바운드 ⭕
- IPv6 전용
- NAT Gateway 대체 개념 (IPv6)

---

### 시험 포인트

- IPv6 환경
- 외부 호출만 필요
- 외부에서 접근되면 안 됨

→ **Egress-Only Internet Gateway**

---

### 한 줄 요약

- **IPv6 아웃바운드 전용 인터넷 통로**

![구조](/assets/images/IPv6Route.png)


---

## AWS Network Firewall

---

## 1. AWS Network Firewall 개요

- VPC에서 사용하는 **관리형 네트워크 방화벽 서비스**
- **L3 ~ L7 트래픽 필터링** 지원
- 중앙에서 네트워크 보안 정책을 관리 가능

---

## 2. 왜 필요한가?

- Security Group / NACL의 한계
    - 단순한 포트·IP 기반 제어
- **패킷 내용, 도메인, 프로토콜 기반 검사 필요**

→ **Network Firewall 사용**

---

## 3. 주요 기능

- Stateful / Stateless 규칙 지원
- IDS / IPS 기능
- 도메인 기반 차단 (예: 악성 도메인)
- Suricata 호환 규칙 사용 가능

---

## 4. 기본 아키텍처

Internet / On-Prem<br>
↓<br>
IGW / TGW<br>
↓<br>
AWS Network Firewall<br>
↓<br>
VPC 리소스<br>


- 트래픽 경로에 **명시적으로 배치**해야 동작

---

## 5. 구성 요소

- **Firewall**
    - 실제 트래픽을 검사하는 리소스

- **Firewall Policy**
    - 적용할 규칙 집합

- **Rule Group**
    - Stateless / Stateful 규칙 정의

---

## 6. 보안 적용 위치

- VPC 내 서브넷 단위로 배치
- 보통 **Inspection Subnet**에 위치

---

## 7. Network Firewall vs 다른 보안 서비스

| 항목 | Network Firewall | AWS WAF |
|------|-----------------|---------|
| 계층 | L3 ~ L7 | L7 (HTTP/HTTPS) |
| 적용 대상 | 모든 IP 트래픽 | 웹 트래픽 |
| 배치 위치 | VPC 내부 | ALB / CloudFront |
| IDS/IPS | ⭕ | ❌ |

---

## 8. 시험 시나리오 예시

- 모든 네트워크 트래픽 검사 필요
- 중앙 보안 정책 적용
- 서드파티 방화벽 관리 부담 제거

→ **AWS Network Firewall**

---

## 9. 한 줄 요약

- **Network Firewall = VPC 내부의 관리형 고급 방화벽**